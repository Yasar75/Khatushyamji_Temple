/*http://demo.agile-labs.com/minZIP/*//*version=3.9.1*/var apiBase=eval(callParent("nodeApi")),sId=eval(callParent("mainSessionId")),utls=eval(callParent("utl")),codeMirrorHintObj={},allTstructs=[],tstructTableObj={},tstructColObj={},mainSqlCM="",tableSqlCM="",tableObj={},isTstGenerated=!1,isEditSelect=!1,presUserName=callParentNew("mainUserName"),nodeAccessToken=callParentNew("nodeAccessToken");function createSqlWindow(){if(!$("#propertySheet").hasClass("scale-out")){$("#selAlwEmpty").is(":visible")?$("#selAlwEmpty").focus():$("#propertySearchFld").focus();'<div id="SLCTradioBtns">','<label class="radio-inline">','<input type="radio" data-target="SQLslctData" name="slctRdioBtns" value="sql">SQL</label>','<label class="radio-inline">','<input type="radio" data-target="TBLslctData" name="slctRdioBtns" value="table">Table</label>','<label class="radio-inline">',"</div>",'<div id="SLCTData">','<div id="SQLslctData" class="slctdataWrapper">','<textarea id="codeMirrorSql"  rows="4"></textarea>',"</div>",'<div id="TBLslctData" class="slctdataWrapper">','<div class="row">','<div class="col-md-6">','<div class="form-group">','<label for="slctTstrctName">Tstruct</label>','<input type="text" class="form-control" id="slctTstrctName">',"</div>","</div>",'<div class="col-md-6">','<div class="form-group">','<label for="slctTblName">Table</label>','<input type="text" class="form-control" id="slctTblName">',"</div>","</div>",'<div class="col-sm-12">','<div id="wtrFldsData"></div>',"</div>",'<div class="col-sm-12" id="tableSqlData" style="display: none;">','<textarea id="tableSqlCM" cols="30" rows="10"></textarea>',"</div>","</div>","</div>",'<div id="SLslctData" class="slctdataWrapper">','<div class="row">','<div class="cloneParent">','<div class="input-field col-sm-10">','<input value="" id="ivColHyPName0" class="cloneChangeId form-control" data-idkey="ivColHyPName" type="text">',"</div>",'<div class="col-sm-2 ivColAdDelWrapper">','<button onclick="genericCloneTheRow(this,\'add\',\'ivColHyp\')" data-index="0" class="waves-effect waves-light addBtn btn-flat"><span class="icon-arrows-plus"></span></button>','<button style="display:none" onclick="genericCloneTheRow(this,\'delete\',\'ivColHyp\')" data-index="0" class="waves-effect waves-light delBtn btn-flat">x<span class="icon"></span></button>',"</div>","</div>","</div>","</div>","</div>","</div>",sqlConfirm=$.confirm({theme:"modern",title:"SQL",content:'<div class="col-md-12"><div id="SLCTradioBtns"><label class="radio-inline"><input type="radio" data-target="SQLslctData" name="slctRdioBtns" value="sql">SQL</label><label class="radio-inline"><input type="radio" data-target="TBLslctData" name="slctRdioBtns" value="table">Table</label><label class="radio-inline"></div><div id="SLCTData"><div id="SQLslctData" class="slctdataWrapper"><textarea id="codeMirrorSql"  rows="4"></textarea></div><div id="TBLslctData" class="slctdataWrapper"><div class="row"><div class="col-md-6"><div class="form-group"><label for="slctTstrctName">Tstruct</label><input type="text" class="form-control" id="slctTstrctName"></div></div><div class="col-md-6"><div class="form-group"><label for="slctTblName">Table</label><input type="text" class="form-control" id="slctTblName"></div></div><div class="col-sm-12"><div id="wtrFldsData"></div></div><div class="col-sm-12" id="tableSqlData" style="display: none;"><textarea id="tableSqlCM" cols="30" rows="10"></textarea></div></div></div><div id="SLslctData" class="slctdataWrapper"><div class="row"><div class="cloneParent"><div class="input-field col-sm-10"><input value="" id="ivColHyPName0" class="cloneChangeId form-control" data-idkey="ivColHyPName" type="text"></div><div class="col-sm-2 ivColAdDelWrapper"><button onclick="genericCloneTheRow(this,\'add\',\'ivColHyp\')" data-index="0" class="waves-effect waves-light addBtn btn-flat"><span class="icon-arrows-plus"></span></button><button style="display:none" onclick="genericCloneTheRow(this,\'delete\',\'ivColHyp\')" data-index="0" class="waves-effect waves-light delBtn btn-flat">x<span class="icon"></span></button></div></div></div></div></div></div>',closeIcon:!0,escapeKey:"Cancel",backgroundDismiss:!0,columnClass:"col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1",onOpenBefore:function(){$("input[type=radio][name=slctRdioBtns]").change(function(){var e=$(this).data("target");$("#SLCTData .slctdataWrapper").hide(),$("#"+e).show(),"table"==$($("input[type=radio][name=slctRdioBtns]")[1]).val()?$("#slctTstrctName").focus():mainSqlCM.focus()}),$($("input[type=radio][name=slctRdioBtns]")[0]).click(),$(".CodeMirror-line span").focus()},onContentReady:function(){getTstructs(),getHintsForCodeMirror(),disableBackDrop("bind"),0!=Object.keys(tableValues).length&&(tableValues.sqlQuery!=undefined?mainSqlCM.setValue(tableValues.sqlQuery):($($("input[type=radio][name=slctRdioBtns]")[1]).click(),$("#slctTstrctName").val(tableValues.tstructObj.value),$("#slctTstrctName").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:tableValues.tstructObj})))},buttons:{Apply:{btnClass:"btn btn-primary",keys:["enter"],action:function(){return saveSelectChanges()}},Cancel:{btnClass:"btn btn-bg-light btn-color-danger btn-active-light-danger",action:function(){$("#codeMirrorSql").removeClass("cdmrEdiSetted"),sqlConfirm.close(),disableBackDrop("destroy")}}}})}}function genericCloneTheRow(e,t,a,l){l=l||"cloneParent";var s=(e=$(e)).parents("."+l);if("add"===t){var o=e.data("index")+1;s.find(".addBtn").hide(),s.find(".delBtn").show();var i="<div class='"+l+"'>"+s.html()+"</div>",r=$(i).insertAfter(s);r.find(".cloneChangeId").each(function(e,t){var a=$(this),l=a.data("idkey");a.attr("id",l+o);var s=a.next();s&&s[0]&&"LABEL"===s[0].nodeName&&s.attr("for",l+o)}),r.find(".addBtn,.delBtn").data("index",o).show()}else if("delete"===t){var n=s.parent();s.remove();var c=n.find("."+l);1===c.length?(n.find(".delBtn").hide(),n.find(".addBtn").show()):c.last().find(".addBtn,.delBtn").show()}}function getHintsForCodeMirror(){if(jQuery.isEmptyObject(codeMirrorHintObj)){var e={async:!0,crossDomain:!0,url:apiBase+"getTstructs",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:{session_id:sId,utl:utls,username:presUserName,authorization:nodeAccessToken,appSKey:appsessionKey}};$.ajax(e).done(function(e){if(isTstGenerated=!0,1==e.status){var t=e.data;t&&($.each(t,function(e,t){codeMirrorHintObj[t[0]]?codeMirrorHintObj[t[0]].push(t[1]):codeMirrorHintObj[t[0]]=[t[1]]}),$("#codeMirrorSql").hasClass("cdmrEdiSetted")?mainSqlCM.refresh():($("#codeMirrorSql").addClass("cdmrEdiSetted"),(mainSqlCM=CodeMirror.fromTextArea(document.getElementById("codeMirrorSql"),{mode:"text/x-sql",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},value:document.documentElement.innerHTML,hintOptions:{tables:codeMirrorHintObj}})).on("change",function(e,t){$("#wizardNextbtn").removeClass("validated")}),addAutoSuggestSql(mainSqlCM)))}else showAlertDialog("warning",e.errMsg)}).fail(function(e,t,a){showAlertDialog("error","Unable to connect node server.")})}else $("#codeMirrorSql").hasClass("cdmrEdiSetted")?mainSqlCM.refresh():($("#codeMirrorSql").addClass("cdmrEdiSetted"),(mainSqlCM=CodeMirror.fromTextArea(document.getElementById("codeMirrorSql"),{mode:"text/x-sql",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},value:document.documentElement.innerHTML,hintOptions:{tables:codeMirrorHintObj}})).on("change",function(e,t){$("#wizardNextbtn").removeClass("validated")}),addAutoSuggestSql(mainSqlCM))}function getTstructs(){if(0==allTstructs.length){var e={async:!0,crossDomain:!0,url:apiBase+"getTstructs",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:{session_id:sId,utl:utls,dname:"dc1",username:presUserName,authorization:nodeAccessToken,appSKey:appsessionKey}};$.ajax(e).done(function(e){if(1==e.status){var t=e.data;t&&($.each(t,function(e,t){allTstructs.push({label:t[1],value:t[1],tId:t[0]})}),creatAutoComplete("#slctTstrctName",!1))}else showAlertDialog("warning",e.errMsg)}).fail(function(e,t,a){showAlertDialog("error","Unable to connect node server.")})}else creatAutoComplete("#slctTstrctName")}function creatAutoComplete(e){$(e).autocomplete({minLength:0,selectFirst:!0,autoFocus:!0,source:function(e,t){t($.ui.autocomplete.filter(allTstructs,e.term).slice(0,20))},select:function(e,t){tableValues.tstructObj=t.item;var a=t.item.tId,l=tstructTableObj[a];l?createTstructTableAutoCom(l,!1):createTstructTableAutoCom(a,!0)}}),$(e).off("focus.manualTri"),$(e).on("focus.manualTri",function(){$(e).autocomplete("search")})}function createTstructTableAutoCom(e,t){if(t){var a={async:!0,crossDomain:!0,url:apiBase+"getTtable",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:{session_id:sId,utl:utls,tstruct:e,username:presUserName,authorization:nodeAccessToken,appSKey:appsessionKey}};$.ajax(a).done(function(t){if(1==t.status){var a=t.data;if(a){for(var l=[],s=0;s<a.length;s++){var o=a[s];l.push({label:o[1],value:o[1],tblName:o[0],dcName:o[2]})}tstructTableObj[e]=l,createTstructTableAutoCom(l,!1)}}else showAlertDialog("warning",t.errMsg)}).fail(function(e,t,a){showAlertDialog("error","Unable to connect node server.")})}else if($("#slctTblName").data("uiAutocomplete")&&$("#slctTblName").autocomplete("destroy"),$("#slctTblName").autocomplete({minLength:0,selectFirst:!0,autoFocus:!0,source:function(t,a){a($.ui.autocomplete.filter(e,t.term).slice(0,20))},select:function(e,t){$("#slctTblName").data("tableName",t.item.tblName),tableValues.tableObj=t.item;createTableCols(isEditSelect?tableValues.tstructObj.tId:$("#slctTstrctName").data("uiAutocomplete").selectedItem.tId,t.item.dcName),isEditSelect=!0}}).focus(),isEditSelect&&($("#slctTblName").val(tableValues.tableObj.value),$("#slctTblName").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:tableValues.tableObj}),tableValues.columnsfrom!=undefined&&0!=tableValues.columnsfrom.length)){for(var l="",s="",o=0;o<tableValues.columnsfrom.length;o++)l+=" <option value='"+tableValues.columnsfrom[o].val.toString()+"' >"+tableValues.columnsfrom[o].text.toString()+"</option>";for(o=0;o<tableValues.columnsto.length;o++)s+=" <option value='"+tableValues.columnsto[o].val.toString()+"' >"+tableValues.columnsto[o].text.toString()+"</option>";""!=l&&($("#extraColMSFrom").append(l),$("#extraColMSTo").html(""),$("#extraColMSTo").append(s)),$("#tableSqlCM").text(tableValues.tableSqlCM),tableSqlCM.getDoc().setValue($("#tableSqlCM").text()),tableSqlCM.refresh(),$("#extraColMSFrom").multiselect("refresh"),$("#extraColMSTo").multiselect("refresh"),tableSqlCM.refresh()}$("#slctTblName").off("focus.manualTri"),$("#slctTblName").on("focus.manualTri",function(){$("#slctTblName").autocomplete("search")})}function ConstructResponsibilityFields(){}function createTableCols(e,t){var a=tstructColObj[e+t];if(a){for(var l=$("#slctTblName").data("tableName"),s="",o=a,i=0;i<o.length;i++){var r=o[i];s+="<option value='"+r[0]+"'>"+r[1]+"</option>"}var n="";n='<div class="row con">',n+='<div class="col-sm-5 multiSelWrap">',n+='<label class="widgetRespLabel">Columns<sup>*</sup></label>',n+='<select name="from[]" id="extraColMSFrom" data-right="#extraColMSTo" data-right-all="#right_All_1" data-right-selected="#right_Selected_1" data-left-all="#left_All_1" data-left-selected="#left_Selected_1" class="form-control1 browser-default rlmultiSlectFld" size="8" multiple="multiple">',n+=s+="<option value='"+l+"id'>"+l+"id</option>",n+="</select>",n+="</div>",n+='<div id="sqlFldColSlctWrapper" class="col col-sm-2 multiSelWrapOpt" style="padding-left: 20px;">',n+='<button title="Select All" type="button" id="right_All_1" class="icon-arrows-right-double">',n+='<i class="icon-chevron-right frstIcn"></i>',n+='<i class="icon-chevron-right scndIcn"></i>',n+="</button>",n+='<button title="Select" type="button" id="right_Selected_1" class="icon-arrows-right">',n+='<i class="icon-chevron-right"></i>',n+="</button>",n+='<button title="Remove" type="button" id="left_Selected_1" class="icon-arrows-left">',n+='<i class="icon-chevron-left"></i>',n+="</button>",n+='<button title="Remove All" type="button" id="left_All_1" class="icon-arrows-left-double-32">',n+='<i class="icon-chevron-left frstIcn"></i>',n+='<i class="icon-chevron-left scndIcn"></i>',n+="</button>",n+="</div>",n+='<div class="col col-sm-5 multiSelWrap multiSelWrap2">',n+='<select name="to[]" id="extraColMSTo" class="form-control1 browser-default rlmultiSlectFld" size="8" multiple="multiple"></select>',n+="</div>",n+="</div>",$("#wtrFldsData").html(n),$("#widgetTableRemData").show(),$("#extraColMSFrom").multiselect({sort:!1,afterMoveToRight:function(e,t,a){createSqlForTableData()},afterMoveToLeft:function(){createSqlForTableData()}})}else{var c={async:!0,crossDomain:!0,url:apiBase+"getTableCols",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:{session_id:sId,utl:utls,tstruct:e,tablename:t,username:presUserName,authorization:nodeAccessToken,appSKey:appsessionKey}};$.ajax(c).done(function(a){if(1==a.status){var l=a.data;l&&(tstructColObj[e+t]=l,createTableCols(e,t))}else showAlertDialog("warning",a.errMsg)}).fail(function(e,t,a){showAlertDialog("error","Unable to connect node server.")})}}function createSqlForTableData(){var e="",t="",a=$("#slctTblName").data("tableName");$("#extraColMSTo option").each(function(a,l){var s=$(this).val();e+=s+",",t+=s+","}),""!==e&&(e=e.slice(0,-1),t=t.slice(0,-1));var l="SELECT "+e+" FROM "+a;$("#tableSqlCM").text(l),$("#tableSqlData").show(),$("#tableSqlCM").hasClass("cdmrEdiSetted")?(tableSqlCM.getDoc().setValue($("#tableSqlCM").text()),tableSqlCM.refresh()):($("#tableSqlCM").addClass("cdmrEdiSetted"),(tableSqlCM=CodeMirror.fromTextArea(document.getElementById("tableSqlCM"),{mode:"text/x-sql",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},value:document.documentElement.innerHTML,hintOptions:{tables:codeMirrorHintObj}})).on("change",function(e,t){$("#wizardNextbtn").removeClass("validated")}),addAutoSuggestSql(tableSqlCM))}function saveSelectChanges(e){var t=$('input[name="slctRdioBtns"]:checked').val();if(!e&&!doTheValidations(t))return!1;if("sql"==t)$("#sqlSource").val(mainSqlCM.getDoc().getValue()),tableValues.sqlQuery=mainSqlCM.getDoc().getValue();else if("table"==t){$("#sqlSource").val(tableSqlCM.getDoc().getValue());var a=[],l=[],s="",o="";$("#extraColMSTo option").each(function(e){s=this.value,o=this.text,l.push({text:o,val:s})}),$("#extraColMSFrom option").each(function(e){s=this.value,o=this.text,a.push({text:o,val:s})}),tableValues.columnsfrom=a,tableValues.columnsto=l,tableValues.tableSqlCM=$("#tableSqlCM").text()}return!0}function isValidQuery(e){e=validateTheSql(e);var t={async:!0,crossDomain:!0,url:apiBase+"getQuery",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:{session_id:sId,utl:utls,q:e,calledFrom:"validate",isMetadata:!1,username:presUserName,authorization:nodeAccessToken,appSKey:appsessionKey}};$.ajax(t).done(function(e){1==e.status?(saveSelectChanges(!0),sqlConfirm.close()):(showAlertDialog("warning",e.errMsg),valSessByApi(e))}).fail(function(e,t,a){showAlertDialog("error","Unable to connect node server.")})}function validateTheSql(e){""!=e&&(";"===(e=e.trim()).substr(-1)&&(e=e.slice(0,-1)));return e}function doTheValidations(e){return"sql"===e?(isValidQuery(mainSqlCM.getDoc().getValue()),!1):""===$("#slctTstrctName").val()?(showAlertDialog("error","Please select a tstruct."),!1):""===$("#slctTblName").val()?(showAlertDialog("error","Please select a table."),!1):0===$("#extraColMSTo option").length?(showAlertDialog("error","Please select atleast one column."),!1):(isValidQuery(tableSqlCM.getDoc().getValue()),!1)}function addAutoSuggestSql(e){e.on("keyup",function(e,t){(!t.ctrlKey&&t.keyCode>=65&&t.keyCode<=90||t.keyCode>=97&&t.keyCode<=122||t.keyCode>=46&&t.keyCode<=57)&&CodeMirror.commands.autocomplete(e)})}