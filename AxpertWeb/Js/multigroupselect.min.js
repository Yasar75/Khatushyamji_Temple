/*www.agilecloud.biz/minZIP?v=3.6*/function GetMultiSelectValues(e,t){var i="",o=$(e).find("select").attr("id"),n=$(e).find("select").hasClass("isrefreshsave"),s=o.substring(0,o.lastIndexOf("F")-3),a=GetMultiSelectPageData(o,"",1,AutPageSize);return $.ajax({url:"tstruct.aspx/GetMultiSelectValues",type:"POST",cache:!1,async:!1,data:JSON.stringify({tstDataId:tstDataId,FldName:s,ChangedFields:ChangedFields,ChangedFieldDbRowNo:ChangedFieldDbRowNo,ChangedFieldValues:ChangedFieldValues,DeletedDCRows:DeletedDCRows,fldNameMs:o,refreshMs:!1,parentsFlds:t,rfSave:n,pageData:a}),dataType:"json",contentType:"application/json",success:function(e){var t=e.d.toString().replace(new RegExp("\\n","g"),"");if(!CheckSessionTimeout(t)&&(t=t.toString().replace(new RegExp("\\t","g"),"&#9;"),ChangedFields=new Array,ChangedFieldDbRowNo=new Array,ChangedFieldValues=new Array,DeletedDCRows=new Array,-1===t.toLowerCase().indexOf("access violation"))){var o=$.parseJSON(t);if(o.error)return void ExecErrorMsg(o.error,"autocomplete");i=o.multiselectdata[3].data}},error:function(e){}}),i}function GetMultiSelectPageData(e,t,i,o){var n="";if(arrRefreshDcs.length>0)for(var s=0;s<arrRefreshDcs.length;s++){var a=arrRefreshDcs[s].split(":");n=a[1].replace("dc","")+","+a[0].replace("dc","")}t=CheckSpecialCharsInStr(t);var l=GetFieldsDcNo(e);AxActiveRowNo=parseInt(GetFieldsRowNo(e),10),AxActiveRowNo=GetDbRowNo(AxActiveRowNo,l);var r=AxActiveRowNo,d="";""!=AxActivePRow&&""!=AxActivePDc&&(d=AxActivePDc+"♠"+AxActivePRow);var c="";return IsParentField(e,l)&&(c=GetSubGridInfoForParent(l,AxActiveRowNo)),i.toString()+"~"+o.toString()+"~"+l+"~"+r+"~"+d+"~"+c+"~"+n}!function(e){"use strict";function t(){}var i=function(){var e=navigator.userAgent.toLowerCase();if(-1!==e.indexOf("safari"))return!(e.indexOf("chrome")>-1)}(),o={readonly:!1,minCount:0,minCountErrorMessage:"",limitCount:Infinity,limitCountErrorMessage:"",input:'<input type="text" maxLength="20" placeholder="" class="fldmultiSelectInput" '+(isMobile?' onfocus="blur()" ':"")+">",data:[],searchable:!0,searchNoData:'<li style="color:#ddd">No Results.</li>',init:t,choice:t,extendProps:[]},n={up:38,down:40,enter:13},s="click.iui-dropdown",a="focus.iui-dropdown",l="keydown.iui-dropdown",r="keyup.iui-dropdown",d=1e3;function c(){var t=this.config,i=this.$el,o=i.find(".dropdown-minItem-alert"),n=t.minCountErrorMessage;clearTimeout(this.itemCountAlertTimer),0===o.length&&(n||(n=t.minCount),o=e('<div class="dropdown-minItem-alert">'+n+"</div>")),i.append(o),this.itemCountAlertTimer=setTimeout(function(){i.find(".dropdown-minItem-alert").remove()},d)}function p(t,i){var o=t||"";o=(o=o.replace(/<select[^>]*>/gi,"").replace("</select>","")).replace(/<\/optgroup>/gi,"");var n='<div class="col-sm-'+(12/i).toString().split(".")[0]+'">';return""!=(o=o.replace(/<optgroup[^>]*>/gi,function(e){var t=/label="(.[^"]*)"(\s|>)/.exec(e),i=/data\-group\-id="(.[^"]*)"(\s|>)/.exec(e),o="";return 1==i[1]?(o=n,o+='<li class="dropdown-group" data-group-id="'+(i?i[1]:"")+'">'+(t?t[1]:"")+"</li>"):(o="</div>"+n,o+='<li class="dropdown-group" data-group-id="'+(i?i[1]:"")+'">'+(t?t[1]:"")+"</li>"),o}))&&(o+="</div>"),o=o.replace(/<option(.*?)<\/option>/gi,function(t){var i=e(t).val(),o=/>(.*)<\//.exec(t),n=t.indexOf("selected")>-1,s=t.indexOf("disabled")>-1,a="";t.replace(/data-(\w+)="?(.[^"]+)"?/g,function(e){a+=e+" "});return"<li "+(s?" disabled":' tabindex="0"')+' data-value="'+(i||"")+'" class="dropdown-option '+(n?"dropdown-chose":"")+'" '+a+">"+(o?o[1]:"")+"</li>"})}function u(t){var i={},o="",n=[],s=0,a=this.config.extendProps;return!(!t||!t.length)&&(e.each(t,function(t,o){var l=o.grouporder,r=o.disabled?" disabled":"",d="true"!=o.selected.toString()||r?"":" selected",c="";e.each(a,function(e,t){o.mslist==t&&(c+="data-"+t+'="'+o.mslist+'" ')});var p="<option"+r+d+' value="'+o.mslist+'" '+c+">"+o.mslist+"</option>";d&&(n.push('<span class="dropdown-selected">'+o.mslist+'<i class="del" data-id="'+o.mslist+'"></i></span>'),s++),l?i[o.grouporder]?i[o.grouporder]+=p:i[o.grouporder]=o.groupby+"♦*♦"+p:i[t]=p}),e.each(i,function(e,t){var i=t.split("♦*♦");if(2===i.length){var n=i[0],s=i[1];o+='<optgroup label="'+n+'" data-group-id="'+e+'">'+s+"</optgroup>"}else o+=t}),[o,n,s])}var h={show:function(t){t.stopPropagation();e(document).trigger("click.dropdown"),this.$el.addClass("active")},search:function(e,t,i){var o,n,s,a=null,l=0;i||(i={});var r=function(){l=!1===i.leading?0:(new Date).getTime(),a=null,s=e.apply(o,n),a||(o=n=null)};return function(){var d=(new Date).getTime();l||!1!==i.leading||(l=d);var c=t-(d-l);return o=this,n=arguments,c<=0||c>t?(clearTimeout(a),a=null,l=d,s=e.apply(o,n),a||(o=n=null)):a||!1===i.trailing||(a=setTimeout(r,c)),s}}(function(t){var i=this.config,o=this.$el,n=e(t.target).val(),s=this.config.data,a=[];if(!(t.keyCode>36&&t.keyCode<41)){e.each(s,function(e,t){(t.groupby&&t.groupby.toLowerCase().indexOf(n.toLowerCase())>-1||t.mslist.toLowerCase().indexOf(n.toLowerCase())>-1||""+t.mslist==""+n)&&a.push(t)});var l=e("select#"+o.find("select").attr("id")+" optgroup").length;o.find("ul").html(p(u.call(this,a)[0],l)||i.searchNoData)}},300),control:function(t){var i,o,s,a=t.keyCode,l=0;a!==n.down&&a!==n.up||(i=a===n.up?-1:1,l=-1===(o=(s=this.$el.find("[tabindex]")).index(e(document.activeElement)))?i+1?-1:0:o,(l+=i)===s.length&&(l=0),s.eq(l).focus(),t.preventDefault())},multiChoose:function(t,i){var o,n=this,s=n.config,a=n.$select,l=e(t.target),r=l.attr("data-value"),d=l.hasClass("dropdown-chose"),p=[];if(l.hasClass("dropdown-display"))return!1;if(d)l.removeClass("dropdown-chose"),n.selectAmount--;else{if(!(n.selectAmount<s.limitCount))return!1;l.addClass("dropdown-chose"),n.selectAmount++}n.name=[],e.each(s.data,function(e,t){""+t.mslist==""+r?(o=t,t.selected=!d):t.selected="true"==t.selected.toString(),t.selected&&(p.push(t.mslist),n.name.push('<span class="dropdown-selected">'+t.mslist+'<i class="del" data-id="'+t.mslist+'"></i></span>'))}),a.find('option[value="'+r+'"]').prop("selected",!d),d&&n.selectAmount<s.minCount&&c.call(n),n.$choseList.find(".dropdown-selected").remove(),n.$choseList.prepend(n.name.join("")),n.$el.find(".dropdown-display").attr("title",p.join(",")),s.choice.call(n,t,o)},singleChoose:function(t){var i=this,o=i.config,n=i.$el,s=i.$select,a=e(t.target),l=a.attr("data-value"),r=a.hasClass("dropdown-chose");if(a.hasClass("dropdown-chose")||a.hasClass("dropdown-display"))return!1;i.name=[],n.removeClass("active").find("li").not(a).removeClass("dropdown-chose"),a.toggleClass("dropdown-chose"),e.each(o.data,function(e,t){t.selected=!1,""+t.id==""+l&&(t.selected=r?0:1,t.selected&&i.name.push('<span class="dropdown-selected">'+t.name+'<i class="del" data-id="'+t.id+'"></i></span>'))}),s.find('option[value="'+l+'"]').prop("selected",!0),i.name.push('<span class="placeholder">'+i.placeholder+"</span>"),i.$choseList.html(i.name.join("")),o.choice.call(i,t)},del:function(t){var i=this,o=i.config,n=e(t.target),s=n.data("id");return e.each(i.name,function(e,t){if(-1!==t.indexOf('data-id="'+s+'"'))return i.name.splice(e,1),!1}),e.each(i.config.data,function(e,t){if(""+t.mslist==""+s)return t.selected=!1,!1}),i.selectAmount--,i.$el.find('[data-value="'+s+'"]').removeClass("dropdown-chose"),i.$el.find('[value="'+s+'"]').prop("selected",!1).removeAttr("selected"),n.closest(".dropdown-selected").remove(),o.choice.call(i,t),!1},clearAll:function(t){var i=this.config;return t&&t.preventDefault(),console.log(this),this.$choseList.find(".del").each(function(t,i){e(i).trigger("click")}),i.minCount>0&&c.call(this),this.$el.find(".dropdown-display").removeAttr("title"),!1}};function f(t,i){this.$el=e(i),this.$select=this.$el.find("select"),this.placeholder=this.$select.attr("placeholder"),this.config=t,this.name=[],this.isSingleSelect=!this.$select.prop("multiple"),this.selectAmount=0,this.itemLimitAlertTimer=null,this.isLabelMode="label"===this.config.multipleMode,this.init()}f.prototype={init:function(){var t=this.config,i=this.$el;this.$select.hide(),i.addClass(this.isSingleSelect?"dropdown-single":this.isLabelMode?"dropdown-multiple-label":"dropdown-multiple"),0===t.data.length&&(t.data=function(t){var i=t,o=[];function n(t,i){var o=e(i);this.id=o.prop("value"),this.name=o.text(),this.disabled=o.prop("disabled"),this.selected=o.prop("selected")}return e.each(i.children(),function(t,i){var s={},a={},l=e(i);"OPTGROUP"===i.nodeName?(a.grouporder=l.data("groupId"),a.groupby=l.attr("label"),e.each(l.children(),e.proxy(n,s)),e.extend(s,a)):e.each(l,e.proxy(n,s)),o.push(s)}),o}(this.$select));var o=u.call(this,t.data);this.name=o[1],this.selectAmount=o[2],this.$select.html(o[0]),this.renderSelect(),this.changeStatus(t.disabled?"disabled":!!t.readonly&&"readonly"),this.config.init()},renderSelect:function(t,i){var o,n=this.$el,s=this.$select,a=s.attr("id"),l=e("select#"+a+" optgroup").length,r=p(s.prop("outerHTML"),l);t?n.find("ul")[i?"html":"append"](r):(o=function(){var e=this.isLabelMode,t=this.config.searchable?'<span class="dropdown-search">'+this.config.input+"</span>":"";return e?'<div class="dropdown-display-label"><div class="dropdown-chose-list">'+t+'</div></div><div class="dropdown-main">{{ul}}</div>':'<a href="javascript:;" class="dropdown-display" tabindex="0"><span class="dropdown-chose-list"></span><a href="javascript:;"  class="dropdown-clear-all" tabindex="0">×</a></a><div class="dropdown-main">'+t+"{{ul}}</div>"}.call(this).replace("{{ul}}","<ul>"+r+"</ul>"),n.append(o).find("ul").removeAttr("style class")),i&&(this.name=[],this.$el.find(".dropdown-selected").remove(),this.$select.val("")),this.$choseList=n.find(".dropdown-chose-list"),this.isLabelMode||this.$choseList.html(e('<span class="placeholder"></span>').text(this.placeholder)),this.$choseList.prepend(this.name?this.name.join(""):[])},bindEvent:function(){var t=this,o=t.$el,d=i?s:a;o.on(s,function(e){e.stopPropagation()}),o.on(s,".del",e.proxy(h.del,t)),t.isLabelMode?(o.on(s,".dropdown-display-label",function(){o.find("input").focus()}),t.config.searchable?o.on(a,"input",e.proxy(h.show,t)):o.on(s,e.proxy(h.show,t)),o.on(l,"input",function(e){8===e.keyCode&&""===this.value&&t.name.length&&o.find(".del").eq(-1).trigger("click")})):(o.on(d,".dropdown-display",e.proxy(h.show,t)),o.on(d,".dropdown-clear-all",e.proxy(h.clearAll,t))),o.on(r,"input",e.proxy(h.search,t)),o.on(r,function(i){i.keyCode===n.enter&&e.proxy(t.isSingleSelect?h.singleChoose:h.multiChoose,t,i)()}),o.on(l,e.proxy(h.control,t)),o.on(s,"li[tabindex]",e.proxy(t.isSingleSelect?h.singleChoose:h.multiChoose,t))},unbindEvent:function(){var e=this.$el,t=i?s:a;e.off(s),e.off(s,".del"),this.isLabelMode?(e.off(s,".dropdown-display-label"),e.off(a,"input"),e.off(l,"input")):(e.off(t,".dropdown-display"),e.off(t,".dropdown-clear-all")),e.off(r,"input"),e.off(s,"[tabindex]")},changeStatus:function(e){"readonly"===e?this.unbindEvent():"disabled"===e?(this.$select.prop("disabled",!0),this.unbindEvent()):(this.$select.prop("disabled",!1),this.bindEvent())},update:function(e,t){var i=this.config,o=(this.$el,t||!1);i.data=o?e.slice(0):i.data.concat(e);var n=u.call(this,i.data);this.name=n[1],this.selectAmount=n[2],this.$select.html(n[0]),this.renderSelect(!0,!1)},destroy:function(){this.unbindEvent(),this.$el.children().not("select").remove(),this.$el.removeClass("dropdown-single dropdown-multiple-label dropdown-multiple"),this.$select.show()},choose:function(t,i){var o="[object Array]"===Object.prototype.toString.call(t)?t:[t],n=this,a=void 0===i||!!i;e.each(o,function(e,t){var o=n.$el.find('[data-value="'+t+'"]');o.hasClass("dropdown-chose")!==a&&o.trigger(s,i||!0)})},reset:function(){h.clearAll.call(this)}},e(document).on("click.dropdown",function(t){e(".dropdown-single,.dropdown-multiple,.dropdown-multiple-label").removeClass("active")}),e.fn.dropdown=function(t){return this.each(function(i,n){e(n).data("dropdown",new f(e.extend(!0,{},o,t),n))}),this}}(jQuery);