/*http://demo.agile-labs.com/minZIP/*//*version=3.9.1*/var fancyTreeObj;function oncontentLoad(){}function showEditNaddbtnDialog(e){var t="";t+='<div class="col-sm-6 col-md-6">',t+=' <div class="form-group">',t+='<label for="txtID">ID</label>',t+='<span class="red">*</span>',t+='<input required id="txtID" type="text" class="form-control fldNme dialogInptFld" >',t+="</div>",t+="</div>",t+='<div class="col-sm-6 col-md-6">',t+=' <div class="form-group">',t+='<label for="txtCaption">Caption</label>',t+='<span class="red">*</span>',t+='<input required id="txtCaption" type="text" class="form-control fldNme dialogInptFld" >',t+="</div>",t+="</div>",t+='<div class="col-sm-6 col-md-6">',t+=' <div class="form-group">',t+='<label for="txtAction">Action</label>',t+='<input required id="txtAction" type="text" class="form-control dialogInptFld" >',t+="</div>",t+="</div>",t+='<div class="col-sm-6 col-md-6">',t+=' <div class="form-group">',t+='<label for="txtTask">Task</label>',t+='<input required id="txtTask" type="text" class="form-control dialogInptFld" >',t+="</div>",t+="</div>",t+='<div class="col-sm-12 col-md-12">',t+=' <div class="form-group">',t+='<label for="txtScript">Script</label>',t+='<textarea id="txtScript" name="txtScript"  class="form-control" ></textarea>',t+="</div>",t+="</div>",t+='<input type="submit" name="Submit" value="Submit" data-dtype="'+e+'" id="dialogSubmit" class="btn btn-primary"  style="margin: 0px auto;display: block;">',"Edit"==e?displayBootstrapModalDialog("Button","md","290px",!1,t,"",loadDataonEditDialog,""):displayBootstrapModalDialog("Button","md","290px",!1,t,"",onAddDialogueContentLoad,"")}function loadDataonEditDialog(){createTheEditor({type:"expression",textarea:$("#txtScript")[0]});var e=fancyTreeObj.getSelectedNodes()[0];$("#txtID").val(e.key).prop("readonly",!0),$("#txtCaption").val(e.title),$("#txtAction").val(e.data.action),$("#txtTask").val(e.data.task),$("#txtScript").val(e.data.script)}function validateEditNaddbtnDialog(e){if("Add"==e){if(""==$("#txtID").val())return showAlertDialog("warning","ID field can not be empty."),!1;if(fancyTreeObj.getNodeByKey($("#txtID").val()))return showAlertDialog("warning","Button ID alredy exists."),!1}return""!=$("#txtCaption").val()||(showAlertDialog("warning","Button Caption can not be empty."),!1)}function validateFile(e,t){var a,o=t.get_fileName(),n=o.substring(o.lastIndexOf(".")+1),r=t._length;if(-1!=$("#hdnUserIconList").val().indexOf(o))throw(a=new Error).name="Duplicate File",a.message="Selected file alredy exists",a;if("jpg"!=n&&"jpeg"!=n&&"png"!=n&&"JPG"!=n&&"PNG"!=n)throw(a=new Error).name="File Format",a.message="Selected file is not supported, please select .jpg, .gif, .png file only",a;if(r>515785)throw(a=new Error).name="Max Size",a.message="Max. icon upload size is 500 KB",a}function uploadError(e,t){showAlertDialog("error",t.get_errorMessage()),$.each($("#uploadIcon input"),function(){$(this).val("")})}function SetNodeIcon(e,t){$("#hdnUserIconList").val($("#hdnUserIconList").val()+t.get_fileName()+","),$(".userIcons").append('<span><img src="'+$("#hdnIconPath").val()+t.get_fileName()+'"><a  href="javascript:void(0)" title="Delete" data-caption='+t.get_fileName()+' class="icon-arrows-remove DltIcnBtn"></a></span>'),$("#lblFileInf").text(t.get_fileName()),$.each($("#uploadIcon input"),function(){$(this).val("")})}function onAddDialogueContentLoad(){createTheEditor({type:"expression",textarea:$("#txtScript")[0]})}function ParseTreeJsonToOrignalformat(e){var t=e.TreeJSON,a=[];return t.forEach(function(e,t){var o=e.data,n=e.children,r=e.title,i=e.key;if(delete e.children,delete e.data,n){var l=[];"undefined"==typeof n.length?l.push(ParseTreeJsonToOrignalformat({TreeJSON:[n]})):n.forEach(function(e,t){l.push(ParseTreeJsonToOrignalformat({TreeJSON:[e]}))}),o?a.push(Object.assign(e,o,{child:l})):a.push(Object.assign(e,{child:l}))}else o?a.push(Object.assign(e,o,{name:r,oname:i})):a.push(e)}),a}$(document).ready(function(){try{var e=JSON.parse(toolbarData).result.row}catch(t){}$("#buttonTree").fancytree({checkbox:!0,selectMode:2,icon:!0,extensions:["dnd5","edit","glyph"],source:e,dnd5:{autoExpandMS:400,focusOnClick:!0,preventVoidMoves:!0,preventRecursion:!0,dragStart:function(e,t){return!0},dragEnter:function(e,t){return!!e.isFolder()||["before"]},dragDrop:function(e,t){t.otherNode.moveTo(e,t.hitMode)},dragEnd:function(e,t){e.data.level=(e.getLevel()-1).toString()}},edit:{adjustWidthOfs:null,triggerStart:["clickActive","dblclick","f2","mac+enter","shift+click","active","focus"],beforeEdit:function(e,t){},edit:function(e,t){$(t.input).attr("maxlength","20")}},glyph:{preset:"material",map:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"radio_button_checked"},docOpen:{text:"web_asset"},folder:{text:"group_work"},folderOpen:{text:"lens"}}},activate:function(e,t){}}),fancyTreeObj=$.ui.fancytree.getTree("#buttonTree"),$("#btnEdit,#btnAdd").on("click",function(){if("Edit"==$(this).data("value")){if(fancyTreeObj.getSelectedNodes().length<1)return showAlertDialog("warning","select at least one button"),!1;if(fancyTreeObj.getSelectedNodes().length>1)return showAlertDialog("warning","select only one node at a time"),!1;if(fancyTreeObj.getSelectedNodes()[0].isFolder())return showAlertDialog("warning","you can ony edit a button by this option. To edit a group double click on on the group node"),!1}showEditNaddbtnDialog($(this).data("value"))}),$("#AddGrp").on("click",function(){fancyTreeObj.getRootNode().editCreateNode("child",{key:"grp"+Date.now().toString(),title:"New group",folder:!0})}),$("html").on("click","#dialogSubmit",function(){if(validateEditNaddbtnDialog($(this).data("dtype"))){if("Edit"==$(this).data("dtype")){var e=$.ui.fancytree.getTree("#buttonTree").getSelectedNodes();e[0].setTitle($("#txtCaption").val()),e[0].data.action=$("#txtAction").val(),e[0].data.task=$("#txtTask").val(),e[0].data.script=$("#txtScript").val(),e[0].renderTitle()}else fancyTreeObj.getRootNode().addChildren({key:$("#txtID").val(),title:$("#txtCaption").val(),action:$("#txtAction").val(),task:$("#txtTask").val(),script:$("#txtScript").val()});closeModalDialog()}}),$("#chngicon").on("click",function(){if(!fancyTreeObj.getSelectedNodes().length)return showAlertDialog("warning","Please select atleast one node."),!1;createIconPopup("uploadIcon","hdnUserIconList",$("#hdnIconPath").val())}),$(document).off("click").on("click",".modal-content #iconWrapperData  span",function(e){if($(e.target).is($(".DltIcnBtn")))return!0;var t=fancyTreeObj.getSelectedNodes();if($(this).find("img").length)for(var a=$(this).find("img").attr("src"),o=0;o<t.length;o++)t[o].icon=a,t[o].renderTitle();else{icon=$(this).text();for(o=0;o<t.length;o++)t[o].icon={text:icon,addClass:"material-icons"},t[o].renderTitle()}}),$(document).on("click",".DltIcnBtn",function(){var e=$(this).data("caption"),t=this;deleteCnfrmBx=$.confirm({theme:"modern",title:"Confirm",onContentReady:function(){disableBackDrop("bind")},onOpen:function(){$(".cnfrmBxHotBtn").focus()},escapeKey:"buttonB",content:"Do you realy want to delete ?",buttons:{buttonA:{text:"Yes",btnClass:"btn btn-primary",action:function(){$.ajax({url:"ToolbarManager.aspx/deleteIconImage",type:"POST",data:JSON.stringify({fileName:e}),dataType:"json",contentType:"application/json",success:function(a){if("Success"==a.d){$(t).parent("span").remove();var o=$("#hdnUserIconList").val().split(","),n=o.indexOf(e);o.splice(n,1),$("#hdnUserIconList").val(o.join()),showAlertDialog("success","Icon deleted successfully")}else showAlertDialog("error","Error while Deleting")},failure:function(){showAlertDialog("error","Error while Deleting")},error:function(){showAlertDialog("error","Error while Deleting")}}),deleteCnfrmBx=""}},buttonB:{text:"Cancel",btnClass:"btn btn-bg-light btn-color-danger btn-active-light-danger",action:function(){disableBackDrop("destroy"),deleteCnfrmBx=""}}}})}),$("#btnDelete").on("click",function(){return selNodes=fancyTreeObj.getSelectedNodes(),0==selNodes.length?(showAlertDialog("warning","Please select atleast one node."),!1):(selNodes.forEach(function(e){for(;e.hasChildren();)e.getFirstChild().moveTo(e.parent,"child");e.remove()}),!1)}),$("#btnSave").on("click",function(){var e=ParseTreeJsonToOrignalformat({TreeJSON:fancyTreeObj.toDict()}),t=JSON.stringify(e);$.ajax({url:"ToolbarManager.aspx/callSaveToolbarWS",type:"POST",cache:!1,async:!0,data:JSON.stringify({structType:structType,structName:structName,toolbarJSON:t}),contentType:"application/json",success:function(e){var t=e.d;"success"==t.status?(showAlertDialog("success","Data saved successfully"),location.reload()):"SESSION_TIMEOUT"==t.msg?parent.window.location.href="../aspx/sess.aspx":showAlertDialog("error",t.msg)},failure:function(){showAlertDialog("error","Error while saving.")},error:function(){showAlertDialog("error","Error while saving.")}})})});