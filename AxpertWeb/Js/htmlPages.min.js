/*http://demo.agile-labs.com/minZIP/*//*version=3.8*/function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var pageNo,pageCaption="",cssFileNameArr=[],jsFileNameArr=[],validateHtmlPage=!0;function SaveNPublishHTML(){if("sect"==transid){var e=htmlCodeMirror.getValue(),r=[],t=[];$(".formGridRow").each(function(){var e=$(this).find("[id^='filename']").val(),o=$(this).find("[id^='filetype']").val(),a=$(this).find("textarea[id^='css_js_src']").val();"css"==o.toLowerCase()?(cssFileNameArr.push(e+pageNo+"."+o.toLowerCase()),r.push(a)):"js"==o.toLowerCase()&&(jsFileNameArr.push(e+pageNo+"."+o.toLowerCase()),t.push(a))}),pageCaption=GetFieldValue("caption000F1");var o=GetFieldValue("addtomenu000F1");try{$.ajax({type:"POST",url:"tstruct.aspx/htmlPagePublish",data:JSON.stringify({htmlString:e,cssFileNameArr:cssFileNameArr,cssString:r,jsFileNameArr:jsFileNameArr,jsString:t,pageCaption:pageCaption,addToMenu:o,pageNo:pageNo}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.d,ShowDialog("success","HTML Pages Saved"),SetFormDirty(!1)},error:function(e){ShowDialog("error","Error while publishing")}})}catch(a){ShowDialog("error","Error while publishing")}}else ShowDialog("success","HTML Pages Saved"),SetFormDirty(!1)}function AxAfterTstLoad(){if(callParentNew("isDWB")&&"sect"==transid){$("#searchBar").hide(),$("#wBdr").addClass("htmlPagesCls"),ToggleWizardDc("3","hide");$(".wizardNextPrevWrapper").append('<button class="hpCustBtns" onclick="javascript:DeleteTstruct();" type="button" title="Delete Tstruct">Remove</button>\n    <button class="hpCustBtns" type="button" id="htmlPagesPreview" title="Preview">Preview</button>\n    <button class="hpCustBtns" type="button" id="addCssRow" title="Add Css">Add Css</button>\n    <button class="hpCustBtns" type="button" id="addJsRow" title="Add Js">Add Js</button>\n    <button class="hpCustBtns" onclick="javascript:CallListView(\'sect\');" type="button" title="Close">Close</button>'),$("#addCssRow, #addJsRow, #htmlPagesPreview").hide(),"0"!=recordid?loadcontentsFromFile():"0"==recordid&&($("#pageno000F1").val(),pageNo="_"+Date.now().toString(),SetFieldValue("pageno000F1",pageNo),UpdateFieldArray("pageno000F1",GetFieldsRowNo("pageno000F1"),pageNo,"parent")),$("#wizardBodyFooterWrapper").on("click","#htmlPagesPreview",function(){displayBootstrapModalDialog("HTML Preview","xxl","400px",!1,$('<iframe id="previewIframe"/>'),"",loadPriviewIframe)}),$("#wizardBodyFooterWrapper").on("click","#addCssRow,#addJsRow",function(){var e,r,t=$(this).attr("id");if($("#DivFrame3").is(":visible")){$("[id^=gridAddBtnAdd]").trigger("click");var o=$("[id^=gridAddBtnAdd]").attr("onclick").split(",")[1],a=$("[id^=gridAddBtnAdd]").attr("onclick").split(",")[2];r="gridrowWrap"+o+"-"+(a=("00"+a).slice(-3))}else"0"!=recordid&&"false"==DCHasDataRows[2].toLowerCase()&&$("[id^=gridAddBtn]").trigger("click"),$("#DivFrame3").show(),r="gridrowWrap3-001";if(e=$("#"+r).find('textarea[id^="css_js"]'),!$(e).hasClass("CodeMirrorApplied"))if("addCssRow"==t){$("#"+r).find('label[for^="css_js"]').text("Css"),$("#"+r).find("[id^='filetype']").val("Css");var i=$("#"+r).find("input[id^='filetype']").attr("id");SetFieldValue(i,"Css"),UpdateFieldArray(i,GetFieldsRowNo(i),"Css","parent"),applyCodeMirror(e,"css")}else if("addJsRow"==t){$("#"+r).find('label[for^="css_js"]').text("Js"),$("#"+r).find("[id^=filetype]").val("Js");i=$("#"+r).find("input[id^='filetype']").attr("id");SetFieldValue(i,"Js"),UpdateFieldArray(i,GetFieldsRowNo(i),"Js","parent"),applyCodeMirror(e,"js")}$("html").on("blur","[id^='filename']",function(){var e=$(this).val();/^[0-9a-zA-Z\_]+$/.test(e)?validateHtmlPage=!0:(ShowDialog("error","FileName is invalid"),validateHtmlPage=!1)}),$("#dvhtml_editor_htmlsrc").css({height:"calc(100vh - 10px)"}),$("#wizardBodyFooterWrapper .wizardBodyContent").scrollTop($("#wizardBodyFooterWrapper .wizardBodyContent")[0].scrollHeight)})}}function applyCodeMirror(e,r){var t=e.attr("id");if("css"==r.toLowerCase()){var o=CodeMirror.fromTextArea(e[0],{mode:"text/css",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,autoRefresh:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-F":"findPersistent"}});o.on("blur",function(){SetFieldValue(t,o.getValue()),UpdateFieldArray(t,GetFieldsRowNo(t),$("#"+t).val(),"parent")}),o.on("keyup",function(e,r){(!r.ctrlKey&&r.keyCode>=65&&r.keyCode<=90||r.keyCode>=97&&r.keyCode<=122||r.keyCode>=46&&r.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),e.addClass("CodeMirrorApplied")}if("js"==r.toLowerCase()){var a=CodeMirror.fromTextArea(e[0],{mode:"text/javascript",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,autoRefresh:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-F":"findPersistent"}});a.on("blur",function(){SetFieldValue(t,a.getValue()),UpdateFieldArray(t,GetFieldsRowNo(t),$("#"+t).val(),"parent")}),a.on("keyup",function(e,r){(!r.ctrlKey&&r.keyCode>=65&&r.keyCode<=90||r.keyCode>=97&&r.keyCode<=122||r.keyCode>=46&&r.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),e.addClass("CodeMirrorApplied")}}function loadPriviewIframe(){if($("#previewIframe").css({border:"none"}),$("#previewIframe")[0].contentWindow.document.open(),""!=htmlCodeMirror.getValue()){$("#previewIframe")[0].contentWindow.document.write(htmlCodeMirror.getValue());var e=$("<style>").prop("type","text/css"),r=$("<script>");$(".formGridRow").each(function(){var t=$(this).find("[id^='filetype']").val(),o=$(this).find("textarea[id^='css_js_src']").val();"css"==t.toLowerCase()?e.append(o):"js"==t.toLowerCase()&&r.append(o)}),$("#previewIframe").contents().find("head").append(e[0]),$("#previewIframe").contents().find("body").append(r[0])}else $("#previewIframe")[0].contentWindow.document.write("No Preview...!");$("#previewIframe")[0].contentWindow.document.close()}function addCSSnJSEditorWRTdata(){$.each($(".formGridRow"),function(){var e=$(this).find("[id^='filetype']").val(),r=$(this).find('textarea[id^="css_js"]'),t=r.attr("id");if("css"==e.toLowerCase()){$(this).find('label[for^="css_js"]').text("Css");var o=CodeMirror.fromTextArea(r[0],{mode:"text/css",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,autoRefresh:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-F":"findPersistent"}});o.on("blur",function(){SetFieldValue(t,o.getValue()),UpdateFieldArray(t,GetFieldsRowNo(t),$("#"+t).val(),"parent")}),o.on("keyup",function(e,r){(!r.ctrlKey&&r.keyCode>=65&&r.keyCode<=90||r.keyCode>=97&&r.keyCode<=122||r.keyCode>=46&&r.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),o.getDoc().setValue(r.val())}if("js"==e.toLowerCase()){$(this).find('label[for^="css_js"]').text("Js");var a=CodeMirror.fromTextArea(r[0],{mode:"text/javascript",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,autoRefresh:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-F":"findPersistent"}});a.on("blur",function(){SetFieldValue(t,a.getValue()),UpdateFieldArray(t,GetFieldsRowNo(t),$("#"+t).val(),"parent")}),a.on("keyup",function(e,r){(!r.ctrlKey&&r.keyCode>=65&&r.keyCode<=90||r.keyCode>=97&&r.keyCode<=122||r.keyCode>=46&&r.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),a.getDoc().setValue(r.val())}})}function loadcontentsFromFile(){pageCaption=GetFieldValue("caption000F1"),pageNo=GetFieldValue("pageno000F1");var e=window.location.pathname.toLowerCase().split("/"),r=e.slice(0,e.indexOf("aspx")>-1?e.indexOf("aspx"):e.length).reduce(function(e,r){return r&&""==e?e+r:e},"")||"",t=window.location.origin+"/"+r,o=t+"/"+proj+"/HTMLPages/"+pageCaption.replace(/ /g,"")+pageNo+".html";jQuery.get(o,function(e){$("#html_editor_htmlsrc000F2").val(e)}),$(".formGridRow").each(function(){var e="",r="",o=$(this).find("[id^='filename']").val(),a=$(this).find("[id^='filetype']").val(),i=$(this).find("textarea[id^='css_js_src']").attr("id");"css"==a.toLowerCase()?(r=t+"/"+proj+"/HTMLPages/Css/"+o+pageNo+".css",jQuery.get(r,function(e){$("#"+i).val(e),$("#"+i).next(".CodeMirror").length>0&&$("#"+i).next(".CodeMirror")[0].CodeMirror.setValue(e)})):"js"==a.toLowerCase()&&(e=t+"/"+proj+"/HTMLPages/Js/"+o+pageNo+".js",jQuery.get(e,function(e){$("#"+i).val(e),$("#"+i).next(".CodeMirror").length>0&&$("#"+i).next(".CodeMirror")[0].CodeMirror.setValue(e)}))})}function createHtmlEditor(e){var r,t=(_defineProperty(r={mode:"htmlmixed",htmlMode:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0},"lineNumbers",!0),_defineProperty(r,"autoRefresh",!0),_defineProperty(r,"foldGutter",!0),_defineProperty(r,"gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"]),_defineProperty(r,"extraKeys",{"Alt-F":"findPersistent"}),r);loadAndCall({files:{css:["/Css/codemirror.css","/ThirdParty/codemirror/addon/hint/show-hint.css","/ThirdParty/codemirror/addon/fold/foldgutter.css","/ThirdParty/codemirror/addon/dialog/dialog.css","/ThirdParty/codemirror/addon/search/matchesonscrollbar.css"],js:["/Js/codemirror/mode/htmlmixed.js","/Js/codemirror/mode/css.js","/Js/codemirror/mode/javascript.js","/Js/codemirror/mode/xml.js","/ThirdParty/codemirror/addon/edit/matchbrackets.js","/ThirdParty/codemirror/addon/edit/closebrackets.js","/ThirdParty/codemirror/addon/hint/show-hint.js","/ThirdParty/codemirror/addon/hint/html-hint.js","/ThirdParty/codemirror/addon/hint/css-hint.js","/ThirdParty/codemirror/addon/hint/javascript-hint.js","/ThirdParty/codemirror/addon/hint/xml-hint.js","/ThirdParty/codemirror/addon/fold/foldgutter.js","/ThirdParty/codemirror/addon/fold/foldcode.js","/ThirdParty/codemirror/addon/display/autorefresh.js","/ThirdParty/codemirror/addon/dialog/dialog.js","/ThirdParty/codemirror/addon/search/searchcursor.js","/ThirdParty/codemirror/addon/search/search.js","/ThirdParty/codemirror/addon/search/matchesonscrollbar.js","/ThirdParty/codemirror/addon/search/match-highlighter.js","/ThirdParty/codemirror/addon/search/jump-to-line.js"]},callBack:function(){htmlCodeMirror=CodeMirror.fromTextArea(document.getElementById(e),t),htmlCodeMirror.on("blur",function(){SetFieldValue(e,htmlCodeMirror.getValue()),UpdateFieldArray(e,"000",$("#"+e).val(),"parent")}),htmlCodeMirror.on("keyup",function(e,r){(!r.ctrlKey&&r.keyCode>=65&&r.keyCode<=90||r.keyCode>=97&&r.keyCode<=122||r.keyCode>=46&&r.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),htmlCodeMirror.getDoc().setValue($("#"+e).val()),"0"!=recordid&&addCSSnJSEditorWRTdata()}})}function AxAfterLoadTab(e){callParentNew("isDWB")&&"sect"==transid&&(1==e&&$("#addCssRow, #addJsRow").hide(),2==e&&($("#wizardBodyContent").append($("#DivFrame3").detach()),$("#addCssRow, #addJsRow, #htmlPagesPreview").show(),("0"==recordid||"0"!=recordid&&"false"==DCHasDataRows[2].toLowerCase())&&$("#DivFrame3").hide()))}function AxBeforeSave(){if(callParentNew("isDWB")&&"sect"==transid)return validateHtmlPage}