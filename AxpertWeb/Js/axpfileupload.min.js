/*http://demo.agile-labs.com/minZIP/*//*version=3.9.1*/function DoClientFunction(){var fn=$j("#fname"),randNumber=$j("#randNumber").val(),filename=escape(fn.val());filename=filename.replace(/%2C/g,",");var upl=$j("#upsts"),succ=upl.val(),fldId="",act=$j("#hdnAttFld"),hdnFilePath=$j("#hdnFilePath");if("Uploaded Successfully"==succ){eval(callParent("isGrdEditDirty")+"= true");var id=act.val(),rowFrmNo=id.substring(id.lastIndexOf("F")-3),rowNo=rowFrmNo.substring(0,rowFrmNo.lastIndexOf("F")),frmNo=rowFrmNo.substring(rowFrmNo.lastIndexOf("F")+1),hlFld=$j("#"+id,doParentOpInIframe("document","rtn","#"+id)),fldsByClass=doParentOpInIframe("document.getElementsByClassName('grdAttach')","rtn",".grdAttach"),tmpFldid="";if("000"!=rowNo)for(var i=0;i<fldsByClass.length;i++)tmpFldid=fldsByClass[i].getAttribute("id"),null!=tmpFldid&&tmpFldid.toLowerCase().startsWith("axpfile_")&&tmpFldid.endsWith(rowFrmNo)&&id.startsWith("GridAxpFileAtt_")&&id=="GridAxpFileAtt_"+tmpFldid&&(fldId=tmpFldid);else fldId=id.replace("ngAxpFileAtt_","");var dcNo=fldId.substring(fldId.lastIndexOf("F")+1,fldId.length),fieldName=callParentNew("GetFieldsName("+id+")","function"),existingFiles=$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId))[0].value;void 0!==existingFiles&&""!=existingFiles&&(filename=existingFiles+","+filename,callParentNew("axInlineGridEdit")||"000"==rowNo?$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId)).val(""):$j($j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId))[1]).val("")),filename=unescape(filename);var fileLinks="",uploadSid=eval(callParent("sid")),hdnScriptsUrlPath=$(parent.$j("#hdnScriptsUrlpath")),ScriptFilePath=hdnScriptsUrlPath.val()+"axpert/"+uploadSid+"/";if(filename.indexOf(",")>-1){arrFileNames=filename.split(","),hlFld.innerHTML="";for(var j=0;j<arrFileNames.length;j++){var finalFileName=unescape(arrFileNames[j]).replace(/\s/g,"♠").replace(/\(/g,"♦").replace(/\)/g,"♣"),actualName=unescape(arrFileNames[j]);"true"==randNumber&&(actualName=actualName.substr(20));var fileOpenLink=arrFileNames[j];fileOpenLink=fileOpenLink.replace(/'/g,"♠"),fileLinks+="000"==rowNo?'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\"  class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'nonGridAxpFile_hlnk'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowAxpFileuploadLink(\""+fldId+'","'+fileOpenLink+'","'+ScriptFilePath+fileOpenLink+"\")'>"+actualName+"</a></div>":'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\"  class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'GridAxpFile_hlnk_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowAxpFileuploadLink(\""+fldId+'","'+fileOpenLink+'","'+ScriptFilePath+fileOpenLink+"\")'>"+actualName+"</a></div>"}}else{var actualName=filename;"true"==randNumber&&(actualName=actualName.substr(20));var finalFileName=filename.replace(/\s/g,"♠").replace(/\(/g,"♦").replace(/\)/g,"♣"),_fileOpenLink=filename.replace(/'/g,"♠");fileLinks+="000"==rowNo?'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\" class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'nonGridAxpFile_hlnk'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowAxpFileuploadLink(\""+fldId+'","'+_fileOpenLink+'","'+ScriptFilePath+_fileOpenLink+"\")'>"+actualName+"</a></div>":'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\" class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'GridAxpFile_hlnk_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowAxpFileuploadLink(\""+fldId+'","'+_fileOpenLink+'","'+ScriptFilePath+_fileOpenLink+"\")'>"+actualName+"</a></div>"}callParentNew("axInlineGridEdit")||"000"==rowNo||"0"==callParentNew("recordid")?$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId)).attr("value",filename).text(filename).val(filename):$j($j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId))[1]).attr("value",filename).text(filename).val(filename),UpdateArray(fldId,filename),""!=$j("#hdnType").val()&&-1==filename.lastIndexOf(".")&&(filename+=$j("#hdnType").val());var labelHtml="";if(labelHtml="000"==rowNo?'<span id="ngAxpFileAtt_'+fldId+'" class="fa fa-paperclip upload-icon nongridAttachIcon inlinediv" style="" onclick="ShowAxpFileAttachPopUp(this);" title="nongrid attachment"></span>':'<span id="GridAxpFileAtt_'+fldId+'" tabindex=\'0\' class="fa fa-paperclip upload-icon inlinediv" onclick="ShowAxpFileAttachPopUp(this);" class="grdAttach handCur" />',labelHtml+="<div id='axpFileAtt_hlnk_"+rowFrmNo+"attach' class='attach-files attach-popover' onclick=\"showAttachmentPopover();\">"+fileLinks+"</div>","000"==rowNo?(fieldName=callParentNew("GetFieldsName("+fldId+")","function"),$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn","#dv"+fieldName)).html(labelHtml)):callParentNew("axInlineGridEdit")||"0"==callParentNew("recordid")?$j("#"+fldId,doParentOpInIframe("document","rtn","#"+fldId)).siblings("#GridAxpFile"+fldId).html(labelHtml):$j($j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId))[1]).siblings("#GridAxpFile"+fldId).html(labelHtml),"000"==rowNo){if($(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divNonGridAxpFile").find(".attach-files").children().addClass("inlinediv"),$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divNonGridAxpFile").find(".attach-files").height()>22){var fileName=$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn","#dv"+fieldName)).attr("data-morefiles");void 0!==fileName&&""!=fileName?fileName+=","+$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divNonGridAxpFile").find(".attach-files").children().last().attr("id"):fileName=$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divNonGridAxpFile").find(".attach-files").children().last().attr("id"),$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn","#dv"+fieldName)).attr("data-morefiles",fileName);var popList=fileName.split(",");$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn","#dv"+fieldName)).find(".attach-files").children().each(function(e,a){var l=$(a).attr("id");$j.inArray(l,popList)>-1&&$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn","#dv"+fieldName)).find(".attach-files").find("[id^="+l.split(".")[0]+"]").addClass("revrseInlinediv")}),$j("#dv"+fieldName+" .divNonGridAxpFile",doParentOpInIframe("document","rtn",".divNonGridAxpFile")).append("<a class='pull-"+("ar"===callParentNew("gllangType","gllangType")?"left":"right")+" attachment-count' href='javascript:void(0)' class='' '><span data-target='axpFileAtt_hlnk_"+rowFrmNo+"attach' class='attach-popover' data-container='.dvheightframe' data-placement='bottom'>"+fileName.split(",").length+"+</span></a>")}}else if(callParentNew("axInlineGridEdit")||"0"==callParentNew("recordid")){$(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files").children().addClass("inlinediv");var _ftsize=$(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files").css("font-size"),_minHght=GetAxpFileControlHeight(_ftsize);if($(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files")[0].offsetHeight>_minHght){var _fileNames=$j("#"+fldId,doParentOpInIframe("document","rtn","#"+fldId)).siblings("#GridAxpFile"+fldId).attr("data-morefiles");void 0!==_fileNames&&""!=_fileNames?_fileNames+=","+$(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files").children().last().attr("id"):_fileNames=$(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files").children().last().attr("id"),$j("#"+fldId,doParentOpInIframe("document","rtn","#"+fldId)).siblings("#GridAxpFile"+fldId).attr("data-morefiles",_fileNames),_fileNames.split(",").forEach(function(e){$(callParentNew(e,"id")).addClass("revrseInlinediv")}),$j("#"+fldId,doParentOpInIframe("document","rtn","#"+fldId)).siblings("#GridAxpFile"+fldId).append("<a class='pull-"+("ar"===callParentNew("gllangType","gllangType")?"left":"right")+" attachment-count' href='javascript:void(0)' class='' '><span data-target='axpFileAtt_hlnk_"+rowFrmNo+"attach' class='attach-popover' data-container='.dvheightframe' data-placement='bottom'>"+_fileNames.split(",").length+"+</span></a>")}else $(callParentNew("attach-files","class")).children().last().removeClass("hide"),$(callParentNew("axpFileAtt_hlnk_"+rowFrmNo+"attach","id"))}else{$($(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files")[1]).children().addClass("inlinediv");var ftsize=$($(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files")[1]).css("font-size"),minHght=GetAxpFileControlHeight(ftsize);if($($(callParentNew("attach-files","class")).parent("#GridAxpFile"+fldId).find(".attach-files")[1])[0].offsetHeight>minHght){var fileNames="";$j("#bootstrapModalData",doParentOpInIframe("document","rtn","#bootstrapModalData")).find("div.atchfile").each(function(){fileNames+=$(this).attr("id")+","}),""!=fileNames&&(fileNames=fileNames.slice(0,-1)),$j("#bootstrapModalData",doParentOpInIframe("document","rtn","#bootstrapModalData")).find("input#"+fldId).siblings("#GridAxpFile"+fldId).attr("data-morefiles",fileNames),$j("#bootstrapModalData",doParentOpInIframe("document","rtn","#bootstrapModalData")).find("input#"+fldId).siblings("#GridAxpFile"+fldId).append("<a class='pull-"+("ar"===callParentNew("gllangType","gllangType")?"left":"right")+" attachment-count' href='javascript:void(0)' class='' '><span data-target='axpFileAtt_hlnk_"+rowFrmNo+"attach' class='attach-popover' data-container='.dvheightframe' data-placement='bottom'>"+fileNames.split(",").length+"+</span></a>"),$j("#bootstrapModalData",doParentOpInIframe("document","rtn","#bootstrapModalData")).find("div.atchfile").each(function(){$(this).addClass("revrseInlinediv")})}else $(callParentNew("attach-files","class")).children().last().removeClass("hide"),$(callParentNew("axpFileAtt_hlnk_"+rowFrmNo+"attach","id"))}callParentNew("axpFileSavedPath=",$j("#hdnaxpFileSavedPath").val()),callParentNew("showAttachmentPopover();","function"),callParentNew("assignInlineGridEditEvent("+frmNo+")","function"),callParentNew("AxGlobalChange=",!0),callParentNew("globalChange=",!0),setTimeout(function(){closeUploadDialog()},300)}else closeUploadDialog()}function GetAxpFileControlHeight(e){var a=20;if(void 0!==e)if((e=parseInt(e.slice(0,-2)))<=14)a=20;else if(15==e||16==e)a=e+6;else if(e>16){a=e+5+Math.floor((e-14)/2+.5)}return a}function UpdateArray(e,a){for(var l=!1,t=0;t<doParentOpInIframe("ChangedFields","rtn").length;t++){if(doParentOpInIframe("ChangedFields["+t+"]","rtn").toString()==e){"***"==a?(doParentOpInIframe("ChangedFields","rtn").splice(t,1),doParentOpInIframe("ChangedFieldDbRowNo","rtn").splice(t,1),doParentOpInIframe("ChangedFieldValues","rtn").splice(t,1),doParentOpInIframe().ChangedFieldOldValues.splice(t,1)):(doParentOpInIframe("ChangedFieldOldValues["+t+"]","var",doParentOpInIframe("ChangedFieldValues["+t+"]","rtn").toString()),doParentOpInIframe("ChangedFieldDbRowNo["+t+"]","var",doParentOpInIframe("ChangedFieldDbRowNo["+t+"]","rtn")),doParentOpInIframe("ChangedFieldValues["+t+"]","var",a)),l=!0;break}}if(!l&&"***"!=a){var i=e.lastIndexOf("F"),n=e.substring(i-3,i),d=e.substring(i+1),r=callParentNew("GetDbRowNo("+n+","+d+")","function");parent.ChangedFields.push(e),parent.ChangedFieldDbRowNo.push(r),parent.ChangedFieldValues.push(a),parent.ChangedFieldOldValues.push("")}}function closeUploadDialog(){$(parent.$(".custom-dialog"))!=undefined&&$(parent.$(".custom-dialog")).length>0&&($(parent).focus(),$(parent.$(".custom-dialog .close"))!=undefined&&$(parent.$(".custom-dialog .close")).length>0&&$(parent.$(".custom-dialog  .close"))[$(parent.$(".custom-dialog .close")).length-1].click(),setTimeout(function(){$(parent.$(".custom-dialog"))[$(parent.$(".custom-dialog")).length-1].remove()},300))}function AllowAttachements(){var e=$j("#hdnAttFld").val(),a=($("#hdnDcNo").val(),""),l=window.parent.$("#"+e).parent().siblings("input").attr("id").substring("axpfile_".length),t="";if($(callParentNew("axpFilePath_"+l,"class")).length>1?$(callParentNew("axpFilePath_"+l,"class")).each(function(e,a){$(a).attr("id").endsWith("_"+l)&&(t=$(a).val())}):t=$(callParentNew("axpFilePath_"+l,"class")).val(),$("#hdnaxpFilePath").val(t),null!=(a=window.parent.$(".attach-files").find(".grdAttach").map(function(e,a){return a.text}).get().join(","))&&""!=a){var i=$("#filMyFile").val();if(null!=i&&""!=i){i=i.substr(12);var n=!1;return $.each(a.split(","),function(e,a){if(a==i)return n=!0,!1}),!n||($("#fileuploadsts").text("File Already Exists"),$("#fileuploadsts").css("color","RED"),!1)}return!1}return!0}function CheckIsFileExists(){alert("File already exists, please rename and upload again!")}$j(document).ready(function(){modalHeader=eval(callParent("divModalHeader","id")+".getElementById('divModalHeader')"),modalHeader.innerText=eval(callParent("lcm[489]")),$("#cmdSend").prop("title",eval(callParent("lcm[490]"))).val(eval(callParent("lcm[490]"))),$("#close").prop("title",eval(callParent("lcm[249]"))).val(eval(callParent("lcm[249]"))),$("#filMyFile").bind({change:function change(){var existingFlCount=parent.$("#"+$j("#hdnAttFld").val()+"attach").parent().find(".attachment-count span").text();existingFlCount=""==existingFlCount?0:existingFlCount;var FileUploadlmt=eval(callParent("AxpFileUploadlmt")),uploadFileCount=$("#filMyFile")[0].files.length,totFlCount=parseInt(existingFlCount)+uploadFileCount;if(void 0!==FileUploadlmt&&0!=FileUploadlmt&&(uploadFileCount>FileUploadlmt||totFlCount>FileUploadlmt))return $("#filMyFile").val(""),$("#fileuploadsts").val(""),void $("#fileuploadsts").text("[Files can upload "+FileUploadlmt+" only.]");var filename=$("#filMyFile").val();if(filename.indexOf("+")>-1&&$("#fileuploadsts").text("[FileName should not contain '+' character.]"),/^\s*$/.test(filename)){$(".file-upload").removeClass("active");var cutMsg=eval(callParent("lcm[66]"));$("#noFile").text(cutMsg)}else $(".file-upload").addClass("active"),$("#noFile").text(filename.replace("C:\\fakepath\\",""));var uploadControl=$("#filMyFile")[0].files;uploadControl.length>0&&$("#lblnofilename").text(uploadControl[0].name);try{ax_changeValidateFileExtensionParams=callParentNew("ax_changeValidateFileExtensionParams")}catch(ex){}1==ValidateFileExtension(filename,"file")?($("#fileuploadsts").val(),$("#cmdSend").prop("disabled",!1),$(".file-upload").addClass("active"),$("#noFile").text(filename.replace("C:\\fakepath\\",""))):($("#fileuploadsts").text("["+eval(callParent("lcm[305]"))+"]"),$("#cmdSend").prop("disabled",!0),ResetFileUploadProperties())}}),checkSuccessAxpertMsg(),setTimeout(function(){IFrameModalDialogTabEvents("file-select")},500),closeRemodalPopupOnEsc(),validateFilesize()}),$(document).keydown(function(e){27==e.which&&$(parent.$(".modal"))!=undefined&&$(parent.$(".modal")).length>0&&($(parent).focus(),$(parent.$(".modal .close"))!=undefined&&$(parent.$(".modal .close")).length>0&&$(parent.$(".modal .close"))[$(parent.$(".modal .close")).length-1].click(),setTimeout(function(){$(parent.$(".modal"))[$(parent.$(".modal")).length-1].remove()},300))});