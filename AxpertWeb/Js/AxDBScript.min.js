/*http://demo.agile-labs.com/minZIP/*//*version=3.8*/function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var mainSqlCM;function setDataTableHeight(){if($.fn.DataTable.isDataTable($("#tblOutput"))){var e=$(".CodeMirror").outerHeight(),t=$(".dvOutput .dataTables_scrollHead").outerHeight(),a=$(".rsltHeader").outerHeight(),o=$("#splitWrapper").outerHeight();scrollBodyHeight=o-(e+a+t),$(".dvOutput .dataTables_scrollBody").css({height:"","max-height":scrollBodyHeight})}}function EditorAutoComplete(e,t){(!t.ctrlKey&&t.keyCode>=65&&t.keyCode<=90||t.keyCode>=97&&t.keyCode<=122||t.keyCode>=46&&t.keyCode<=57)&&CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}function ExecuteShortcut(e){if(e.ctrlKey&&69==e.keyCode)return $("#exeQuery").trigger("click"),e.preventDefault(),!1}function decodeBase64(e){for(var t=atob(e),a=t.length,o=new Uint8Array(a),r=0;r<a;r++)o[r]=t.charCodeAt(r);return(new TextDecoder).decode(o)}function createDatatableFromJson(e,t){if($.fn.DataTable.isDataTable(t)&&(t.DataTable().destroy(),t.empty()),"undefined"!=typeof e.result.row&&0!=e.result.row.length){if(t.DataTable({data:e.result.row,columns:Object.keys(e.result.row[0]).map(function(t){return"blob"==$.map(e.result.fields,function(e,a){if(e.name==t)return e.datatype}).toString()?{data:t,title:t,render:function(e,a,o,r){return"<a href='#' class='lnkBlob' data-value="+e+" data-title="+t+">Blob</a>"}}:{data:t,title:t}}),autoWidth:!1,paging:!1,filter:!1,bInfo:!1,scrollX:!0,scrollY:"200px"}),t.is($("#tblOutput"))){var a=$("#tblOutput").DataTable().data().count();$("#spnRowCnt").text("No. of rows : "+a),setDataTableHeight()}else $(".dataTables_scrollBody").css({height:"","max-height":" calc(100vh - 99px)"});$("#noRecord").addClass("hide")}else t.is($("#tblOutput"))?(showAlertDialog("warning","No records found"),$("#spnRowCnt").text("No. of rows : 0")):$("#noRecord").removeClass("hide")}function createTreeView(){if(""!=DbObjData){DbObjData=DbObjData.replace(/&apos;/g,"'");var e=parseXml(DbObjData);DbObjDataJSON=JSON.parse(xml2json(e,""))}var t=_parseTheJSONForTreeView(DbObjDataJSON.root);$("#treeView").fancytree({icon:!0,source:t,extensions:["glyph","filter"],glyph:{preset:"material",map:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"web_asset"},docOpen:{text:"web_asset"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}},filter:{autoExpand:!0,hideExpandedCounter:!1,mode:"hide",counter:!1},click:function(e,t){if("expander"==t.targetType)return!0;var a=$.ui.fancytree.getTree("#treeView");if(mainSqlCM.getDoc().setValue(""),$("#noRecord").addClass("hide"),$("table").each(function(){$.fn.DataTable.isDataTable($(this))&&($(this).DataTable().destroy(),$(this).empty())}),$("#txtOutput").html(""),$("#tblOutput").empty(),t.node==a.getFirstChild())openEditor();else if("title"==t.targetType&&1==t.node.folder){$(".DbNavTabs").hide(),$(".AxDBToolBar").hide(),$(".dvOutput").hide(),$(".tab-content").hide(),$("#dvObjList").show(),loadObjectInfo("",o=t.node.title,"allobjData")}else if("title"==t.targetType&&0==t.node.folder){showHideRespectiveNavtabs(t),$(".CodeMirror").resizable("disable").height("100%"),mainSqlCM.setOption("readOnly",!0),mainSqlCM.off("keyup",EditorAutoComplete),$("html").off("keydown",ExecuteShortcut),$(".DbNavTabs").show(),$(".AxDBToolBar").hide(),$(".dvOutput").hide(),$(".tab-content").show(),$("#dvObjList").hide(),$("#ScriptToolBar").show();var o=t.node.data.parent;loadObjectInfo(t.node.title,o,"Tables"==o||"Views"==o||"Indexes"==o?"Columns":"Sequences"==o?"Info":"Script/Source")}}})}function openEditor(){$(".CodeMirror").resizable("enable").height("50%"),mainSqlCM.setOption("readOnly",!1),mainSqlCM.on("keyup",EditorAutoComplete),$("html").on("keydown",ExecuteShortcut),mainSqlCM.refresh(),$('.DbNavTabs a[href="#QryEditor"]').tab("show"),$(".DbNavTabs").hide(),$(".AxDBToolBar").show(),$(".dvOutput").show(),$(".tab-content").show(),$("#dvObjList").hide(),$("#ScriptToolBar").hide()}function loadObjectInfo(e,t,a){ShowDimmer(!0);try{$.ajax({url:"AxDBScript.aspx/loadObjectInfo",type:"POST",cache:!1,async:!1,data:JSON.stringify({objName:e,objType:t,objInfo:a}),dataType:"json",contentType:"application/json",success:function(e){e.d;"SESSION_TIMEOUT"==e.d?parent.window.location.href="../aspx/sess.aspx":(dataJSON=JSON.parse(e.d),parseObjInfoJSON(dataJSON,a)),ShowDimmer(!1)},error:function(){showAlertDialog("error","Error while fetching the details."),ShowDimmer(!1)}})}catch(o){showAlertDialog("error","Error while fetching the details."),ShowDimmer(!1)}}function _parseTheJSONForTreeView(e){var t=[],a=e.parent;return a.length===undefined&&(a=[a]),a&&a.forEach(function(e,a){var o=e.row;if(o){var r=[],n=getTheIcon(e.title);o.length==undefined?r.push({title:o.column1["#text"],tooltip:o.column1["#text"],parent:e.title,folder:!1,icon:n}):o.forEach(function(t,a){r.push({title:t.column1["#text"],tooltip:t.column1["#text"],parent:e.title,folder:!1,icon:n})}),t.push({title:e.title,folder:!0,children:r,icon:n})}else{var i=getTheIcon(e.title);t.push({title:e.title,folder:!1,icon:i})}}),t}function getTheIcon(e){switch(e){case"Editor":return{text:"filter_frames",addClass:"material-icons"};case"Tables":return{text:"table_chart",addClass:"material-icons"};case"Views":return{text:"visibility",addClass:"material-icons"};case"Functions":return{text:"functions",addClass:"material-icons"};case"Indexes":return{text:"format_list_numbered",addClass:"material-icons"};case"Procedures":return{text:"format_textdirection_l_to_r",addClass:"material-icons"};case"Triggers":return{text:"swap_calls",addClass:"material-icons"};case"Sequences":return{text:"linear_scale",addClass:"material-icons"}}}function parseObjInfoJSON(e,t){switch(t){case"Script/Source":if($("#noRecord").addClass("hide"),"undefined"!=typeof e.result.row&&0!=e.result.row.length){result=e.result.row[0];var a=Object.keys(e.result.row[0]);mainSqlCM.getDoc().setValue(result[a[0]])}break;case"Columns":createDatatableFromJson(e,$("#tblColumns"));break;case"Indexes":createDatatableFromJson(e,$("#tblIndexes"));break;case"Triggers":createDatatableFromJson(e,$("#tblTriggers"));break;case"Data":createDatatableFromJson(e,$("#tblData"));break;case"Error":createDatatableFromJson(e,$("#tblError"));break;case"Argument":createDatatableFromJson(e,$("#tblArgs"));break;case"Info":createDatatableFromJson(e,$("#tblInfo"));break;case"allobjData":createDatatableFromJson(e,$("#tblObjList"))}}function showHideRespectiveNavtabs(e){"Tables"==e.node.data.parent||"Views"==e.node.data.parent||"Tables"==e.node.title||"Views"==e.node.title?($("#tabSource").show(),$("#tabColumns").show(),$("#tabIndexes").show(),$("#tabTriggers").show(),$("#tabData").show(),$("#tabErrors").hide(),$("#tabArgs").hide(),$("#tabInfo").hide(),$('.DbNavTabs a[href="#dvColumns"]').tab("show")):"Procedures"==e.node.data.parent||"Procedures"==e.node.title||"Functions"==e.node.data.parent||"Functions"==e.node.title?($("#tabSource").show(),$("#tabColumns").hide(),$("#tabIndexes").hide(),$("#tabTriggers").hide(),$("#tabData").hide(),$("#tabErrors").show(),$("#tabArgs").show(),$("#tabInfo").hide(),$('.DbNavTabs a[href="#QryEditor"]').tab("show")):"Indexes"==e.node.data.parent||"Indexes"==e.node.title?($("#tabSource").show(),$("#tabColumns").show(),$("#tabIndexes").hide(),$("#tabTriggers").hide(),$("#tabData").hide(),$("#tabErrors").hide(),$("#tabArgs").hide(),$("#tabInfo").hide(),$('.DbNavTabs a[href="#dvColumns"]').tab("show")):"Triggers"==e.node.data.parent||"Triggers"==e.node.title?($("#tabSource").show(),$("#tabColumns").hide(),$("#tabIndexes").hide(),$("#tabTriggers").hide(),$("#tabData").hide(),$("#tabErrors").hide(),$("#tabArgs").hide(),$("#tabInfo").hide(),$('.DbNavTabs a[href="#QryEditor"]').tab("show")):"Sequences"!=e.node.data.parent&&"Sequences"!=e.node.title||($("#tabSource").show(),$("#tabColumns").hide(),$("#tabIndexes").hide(),$("#tabTriggers").hide(),$("#tabData").hide(),$("#tabErrors").hide(),$("#tabArgs").hide(),$("#tabInfo").show(),$('.DbNavTabs a[href="#dvInfo"]').tab("show"))}function ShowDimmer(e){DimmerCalled=!0;var t=$("#waitDiv");if(t.length>0&&t!=undefined)if(1==e){var a=$("#middle1",parent.document);a&&t.width(a.width()),t.show(),document.onkeydown=function(){return!1}}else t.hide(),document.onkeydown=function(){if(1==DimmerCalled)return!0};else window.opener!=undefined&&(t=$("#waitDiv",window.opener.document)).length>0&&(1==e?t.show():t.hide());DimmerCalled=!1}$(document).ready(function(){document.referrer&&-1==document.referrer.toLowerCase().indexOf("/dwb.aspx")&&-1==document.referrer.toLowerCase().indexOf("/axdbscript.aspx")&&($("#schemaBrwsr").addClass("hideMenu"),$("#toggleScriptMenuLeft").find("span").text("navigate_next")),$("table").on("scroll resize",function(){$(this).children().width($(this).width()+$(this).scrollLeft()),$(this).children().height($(this).height()+$(this).scrollTop())}),(mainSqlCM=CodeMirror.fromTextArea(txtEditor,{mode:"text/x-sql",smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,autofocus:!0,hintOptions:{tables:callParentNew("mainSqlHintObj")},theme:"elegant"})).on("keyup",EditorAutoComplete),$("html").on("keydown",ExecuteShortcut),setInterval(function(){mainSqlCM.refresh()},500),$("#exeQuery").click(function(){var e;e=""!=mainSqlCM.getSelection()?mainSqlCM.getSelection():mainSqlCM.getValue(),ShowDimmer(!0);try{$.ajax({url:"AxDBScript.aspx/callExecuteSQL",type:"POST",cache:!1,async:!1,data:JSON.stringify({queryString:e}),dataType:"json",contentType:"application/json",success:function(e){if("SESSION_TIMEOUT"==e.d)parent.window.location.href="../aspx/sess.aspx";else if(""!=e.d){var t=$.fn.dataTable.fnTables(!0);$(t).each(function(){$(this).dataTable().fnDestroy(),$(this).empty()}),dataJSON=JSON.parse(e.d),"undefined"!=typeof dataJSON.error?($("#txtOutput").text(dataJSON.error.msg),$("#txtOutput").show(),$("#tblOutput").hide(),$("#spnRowCnt").hide()):"object"!=_typeof(dataJSON.result)?($("#txtOutput").text(dataJSON.result),$("#txtOutput").show(),$("#tblOutput").hide(),$("#spnRowCnt").hide()):($("#txtOutput").hide(),$("#tblOutput").show(),$("#spnRowCnt").show(),createDatatableFromJson(dataJSON,$("#tblOutput")))}ShowDimmer(!1)},error:function(){showAlertDialog("error","Error while executing the query."),ShowDimmer(!1)}})}catch(t){showAlertDialog("error","Error while executing the query."),ShowDimmer(!1)}return!1}),$("#clrEdtr").click(function(){return mainSqlCM.getDoc().setValue(""),$("#txtOutput").html("").show(),$.fn.DataTable.isDataTable($("#tblOutput"))&&$("#tblOutput").DataTable().destroy(),$("#tblOutput").empty().hide(),$("#spnRowCnt").hide(),!1}),$("#copyScript").click(function(){var e=document.createElement("textarea");document.body.appendChild(e),e.value=mainSqlCM.getValue(),e.select(),document.execCommand("copy"),document.body.removeChild(e),showAlertDialog("info","copied successfully")}),$("#editScript").click(function(){openEditor()}),createTreeView(),$("input[name=search]").on("keyup",function(e){var t=$.ui.fancytree.getTree("#treeView"),a=t.filterBranches,o=$(this).val();e&&e.which===$.ui.keyCode.ESCAPE||""===$.trim(o)?t.clearFilter():a.call(t,o)}),$(".DbNavTabs a[data-toggle=tab]").on("click",function(e){var t=$.ui.fancytree.getTree("#treeView").getActiveNode(),a=t.data.parent;loadObjectInfo(t.title,a,$(e.target).text())}),$("#toggleScriptMenuLeft").on("click",function(e){var t=$(this).find("span").text();$("#schemaBrwsr").toggleClass("hideMenu"),$(this).find("span").text("navigate_next"==t?"navigate_before":"navigate_next"),$($.fn.dataTable.tables(!0)).DataTable().columns.adjust()}),$(".CodeMirror").resizable({handles:"s",resizeWidth:!1,resize:function(e,t){setDataTableHeight()}}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){$($.fn.dataTable.tables(!0)).DataTable().columns.adjust()}),$("html").on("click",".lnkBlob",function(){var e=$(this).data("value"),t=$(this).data("title"),a="";a+=' <div class="form-group">',a+='<textarea id="" name="txtScript" rows="12"  class="form-control" style="resize: none;" >'+decodeBase64(e)+"</textarea>",a+="</div>",displayBootstrapModalDialog(t,"md","",!1,a,"","","")})}),window.onerror=function(e){showAlertDialog("error",e),ShowDimmer(!1)};