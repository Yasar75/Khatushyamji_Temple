/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/var fldAutoData=[],fldAutoList="",fldExpData=[],colNames=[],colVExp=[],colfExp=[],aportionWhat=[],aportionAgainst=[],aportionWhatVal=[],isQuery="",QueryData="",colSource=[],thisFldId="",valuesep="",rowsep="";function LoadTableEvents(dvId){var autoDiv=dvId==undefined?"#divDc1":dvId;$j(dvId).find(".tblFromSelect:not(span)").select2(),createFormSelect(dvId+" .tblFromSelect:not(span)");var glType=eval(callParent("gllangType")),dtpkrRTL=!1;dtpkrRTL="ar"==glType;var glCulture=eval(callParent("glCulture")),dtFormat="dd/mm/yy";"en-us"==glCulture&&(dtFormat="mm/dd/yy"),$(".flatpickr-input").flatpickr({dateFormat:dtFormat}),$j(dvId+" .number").unbind("keypress"),$j(".number").keypress(function(e){return CheckNumeric(e,$j(this).val())}),$j("input.number").on("input",function(){var e=$j(this).val(),a=$j(this).attr("id"),t=$j(this).attr("data-fInd");if(a!=undefined){var l=callParentNew("FMaxLength")[t],n=callParentNew("FDecimal")[t];if(n!=undefined&&n>0){var r=l-n-1;if(-1==e.indexOf("."))e.length>r&&$j(this).val(e.slice(0,r));else if(-1!=e.indexOf(".")){var s=e.substring(0,e.indexOf(".")),i=e.substring(e.indexOf(".")+1,e.length);s.length>r&&(s=s.slice(0,r)),i.length>n&&(i=i.slice(0,n)),$j(this).val(s+"."+i)}}}}),$j(":text").unbind("blur"),$j(":text").blur(function(e){MainBlur($j(this),"input")}),$j("select").unbind("change"),$j("select").change(function(){MainBlur($j(this),"select")}),$(dvId).find(".selection .select2-selection").addClass("form-select-sm"),$(dvId).find(".select2-hidden-accessible").addClass("form-select-sm"),$(dvId).find(".fldmultiSelect").addClass("py-0")}$j(document).ready(function(){GetTableHtml(),$j(":text").blur(function(e){MainBlur($j(this),"input")}),$j("select").change(function(){MainBlur($j(this),"select")}),LoadTableEvents("#divTable")});var dtAssoc=[],searchResult=[],AutPageNo=1,AutPageSize=50,rcount=0,fetchRCount=callParentNew("FetchPickListRows")||1e3;PageCount=0;var CangefldName="",isNavigation=!1,refreshAC=!1,pickarrow=!1;function createFormSelect(fld){var formSelect=$(fld),fldNameAc="",fieldName="",fastdll="",termVal="",depFldName="";formSelect.select2({ajax:{url:"tstruct.aspx/GetAutoCompleteData",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",delay:250,data:function(e){termVal=e.term==undefined?"":e.term;var a=$(this).attr("data-id");fastdll=$(callParentNew(a,"id")).hasClass("fastdll");var t=$(callParentNew(a,"id")).hasClass("isrefreshsave"),l=GetSourceParamValue($(this)),n=GetAutoCompData(fldNameAc,termVal,AutPageNo,AutPageSize),r=fldNameAc.substring(0,fldNameAc.lastIndexOf("F")-3),s="";s=void 0!==callParentNew("wsPerfEnabled")&&callParentNew("wsPerfEnabled")?callParentNew("ISBoundAutoCom("+r+","+fldNameAc+")","function"):callParentNew("ISBoundNew("+r+","+fldNameAc+")","function");var i=callParentNew("GetFieldIndex("+r+")","function"),o=callParentNew("FldIsAPI")[i];return JSON.stringify({tstDataId:callParentNew("tstDataId"),FldName:r,FltValue:termVal,ChangedFields:parent.ChangedFields,ChangedFieldDbRowNo:parent.ChangedFieldDbRowNo,ChangedFieldValues:parent.ChangedFieldValues,DeletedDCRows:parent.DeletedDCRows,pageData:n,fastdll:fastdll,fldNameAc:fldNameAc,refreshAC:refreshAC,pickArrow:pickarrow,parentsFlds:s,rfSave:t,IsApiFld:o,tblSourceParams:l})},processResults:function processResults(data){refreshAC=!1;try{var result=data.d.toString().replace(new RegExp("\\n","g"),"");if(""!=result&&result.split("*♠*").length>1&&(result=result.split("*♠*")[0]),callParentNew("CheckSessionTimeout("+result+")","function"))return;if(result=result.toString().replace(new RegExp("\\t","g"),"&#9;"),ChangedFields=new Array,ChangedFieldDbRowNo=new Array,ChangedFieldValues=new Array,DeletedDCRows=new Array,!result.toLowerCase().includes("access violation")||!result.toLowerCase().includes("asbtstruct.dll")){var serResult=$.parseJSON(result);if(datasss=serResult,serResult.error)return void ExecErrorMsg(serResult.error,"autocomplete");if(dtAssoc=serResult.pickdata[3].data,dtAssoc!=undefined&&0!=dtAssoc.length){if(fastdll){var aSearch=[];if($(dtAssoc).each(function(e,a){a.i=a.i.replace(/\^\^dq/g,'"'),a.i.toLowerCase().indexOf(termVal.toLowerCase())>=0&&aSearch.push(a)}),$("#"+fldNameAc).data("rowcount",aSearch.length),0!=aSearch.length){var result=$.map(aSearch,function(e){return e.i=e.i.replace(/\^\^dq/g,'"'),{id:""==e.v?e.i:e.v,text:e.i,dep:e.d}});return searchResult=result,{results:result}}var cutMsg=eval(callParent("lcm[0]"));return{results:"",noResults:cutMsg}}var result=$.map(dtAssoc,function(e){return e.i=e.i.replace(/\^\^dq/g,'"'),{id:""==e.v?e.i:e.v,text:e.i,dep:e.d}});return searchResult=result,{results:result}}var cutMsg=eval(callParent("lcm[0]"));return{results:"",noResults:cutMsg}}AxWaitCursor(!1),ShowDimmer(!1),$("#reloaddiv").show(),$("#dvlayout").hide()}catch(exception){-1!=exception.message.toLowerCase().indexOf("access violation")&&(AxWaitCursor(!1),ShowDimmer(!1),$("#reloaddiv").show(),$("#dvlayout").hide())}}},placeholder:"Search for a repository",minimumInputLength:0}).on("select2:open",function(e){var a=$(this).attr("data-id");fldNameAc=a})}function GetTableHtml(){var e="";try{parent.ChangedTblFields=new Array,parent.ChangedTblFieldVals=new Array,thisFldId=$("#hdnfieldId").val();var a=$(callParentNew(thisFldId,"id")).val(),t=$(callParentNew(thisFldId,"id")).prop("disabled"),l=callParentNew("GetFieldsRowNo("+thisFldId+")","function"),n=thisFldId.substring(0,thisFldId.lastIndexOf("F")-3),r=callParentNew("GetFieldIndex("+n+")","function"),s=callParentNew("FTableTypeVal")[r];if(""!=s){if((s=RepSpecialCharsInHTML(s)).startsWith("{")||s.startsWith("db@"))s.startsWith("db@")&&(s=GetDBProcTableJson(s));else{var i=s.split("~")[1],o=callParentNew("GetDcNo("+i+")","function");s=GetstrTableJson("True"==parent.DCIsGrid[o-1]?$(callParentNew(i+l+"F"+o,"id")).val():$(callParentNew(i+"000F"+o,"id")).val())}var d=JSON.parse(s);if(void 0!==d){var c=d.props.type,u=d.props.colcount,p=d.props.rowcount,f=d.props.deleterow,v=d.props.addrow;rowsep=d.props.rowseparator,valuesep=d.props.valueseparator,"undefined"!=typeof d.props.sql&&(isQuery=d.props.sql);var h=1==t?"disabled":"";if("table"==c){var m="";""!=a&&(m=a.split(rowsep)).length>p&&(p=m.length),""==m&&"true"==isQuery&&SqlFillData();var b="",g="";b+='<tr class="fw-bold fs-6 text-gray-800 border-bottom-2 border-gray-200">',"t"!=f.toLowerCase()&&"true"!=f.toLowerCase()||(b+='<th class="w-10px"></th>');for(var w=0;w<u;w++){var N=d.columns[w+1].caption;colNames.push(d.columns[w+1].name),parent.ChangedTblFields.push(d.columns[w+1].name),parent.ChangedTblFieldVals.push(""),b+="<th>"+N+"</th>";var y=d.columns[w+1].exp;colfExp.push(y);var F="";if(""!=y&&(y=y.replace(/,/g,"♦"),F=callParentNew("Evaluate("+d.columns[w+1].name+",000,"+y+",expr,table)","function")),fldExpData.push(F),colVExp.push(d.columns[w+1].vexp),"undefined"!=typeof d.columns[w+1].aportionwhat&&""!=d.columns[w+1].aportionwhat){aportionWhat.push(d.columns[w+1].aportionwhat);var C=d.columns[w+1].aportionwhat,x=$j($j("[id*='"+C+"']",doParentOpInIframe("document","rtn","[id*='"+C+"']")).find("input")).attr("id");aportionWhatVal.push($(callParentNew(x,"id")).val())}else aportionWhat.push(""),aportionWhatVal.push("");"undefined"!=typeof d.columns[w+1].aportionagainst?aportionAgainst.push(d.columns[w+1].aportionagainst):aportionAgainst.push("")}b+="</tr>";for(var I=0;I<p;I++){var P="";"undefined"!=typeof m[I]&&""!=m[I]&&""!=m&&(P=(P=m[I]).split(valuesep)),g+="<tr id="+I+">","t"!=f.toLowerCase()&&"true"!=f.toLowerCase()||(g+='<td class="input-group-sm"><div class="form-check form-check-sm form-check-custom p-2"><input type="checkbox" class="form-check-input fgChk" name="chkItem" onclick="javascript:ChkHdrCheckbox(this);" '+h+"></div></td>");var D=function(){var e="";e="undefined"!=typeof P[w]&&""!=P[w]&&""!=P?P[w]:"undefined"!=typeof fldExpData[w]&&""!=fldExpData[w]?fldExpData[w]:"undefined"!=typeof aportionWhatVal[w]&&""!=aportionWhatVal[w]&&0==I?aportionWhatVal[w]:d.columns[w+1].value;var a=d.columns[w+1].source,t="";"undefined"!=typeof d.columns[w+1].allowempty&&""!=d.columns[w+1].allowempty&&(t="f"==d.columns[w+1].allowempty.toLowerCase()?" data-ae='false' ":"");var n="";"undefined"!=typeof d.columns[w+1].allowduplicate&&""!=d.columns[w+1].allowduplicate&&(n="f"==d.columns[w+1].allowduplicate.toLowerCase()?" data-ad='false' ":"");var r="";"undefined"!=typeof d.columns[w+1].readyonly&&""!=d.columns[w+1].readyonly&&(r="t"==d.columns[w+1].readyonly.toLowerCase()?" disabled ":""),colSource.push(a);var s=callParentNew("GetFieldIndex("+a+")","function"),i=(callParentNew("GetDWBFieldType('',"+s+")","function"),callParentNew("GetDcNo("+a+")","function")),o=a+l+"F"+i;if("Select"==callParentNew("FMoe")[s])if("True"==callParentNew("FldIsSql")[s])g+='<td class="input-group-sm"><select '+h+r+t+n+' class="combotem Family form-control form-select tblFromSelect fldtableinput" data-control="select2" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'" data-id="'+o+'" data-placeholder="Select an option" data-allow-clear="true">',""!=e&&(g+='<option value="'+e+'" selected="selected">'+e+"</option>"),g+="</select></td>";else if(S="",$(callParentNew(o)).find("option").each(function(){""!=e&&$(this)[0].value==e?S+=$(this)[0].outerHTML.replace("<option ","<option selected "):S+=$(this)[0].outerHTML.replace('selected="selected"',"")}),""==S){var c=$(callParentNew(o)).data("val").split(","),u=""==$(callParentNew(o)).val()?e:$(callParentNew(o)).val();for(V=0;V<c.length;V++)""!=u&&u==c[V]?S+='<option selected="selected" value="'+c[V]+'">'+(""==c[V]?"-- Select --":c[V])+"</option>":S+='<option value="'+c[V]+'">'+(""==c[V]?"-- Select --":c[V])+"</option>";g+='<td class="input-group-sm"><select '+h+r+t+n+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+u+'">'+S+"</select></td>"}else g+='<td class="input-group-sm"><select '+h+r+t+n+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'">'+S+"</select></td>";else if("Accept"==callParentNew("FMoe")[s]&&"True"==callParentNew("FldIsSql")[s])g+='<td class="input-group-sm"><input '+h+r+t+n+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'"></td>';else if("undefined"!=typeof aportionWhat[w]&&""!=aportionWhat[w])g+='<td class="input-group-sm"><input '+h+r+t+n+' type="text" class="tem Family form-control fldtableinput" readonly name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'"></td>';else if("Numeric"==callParentNew("FDataType")[s])g+='<td class="input-group-sm"><input '+h+r+t+n+' type="text" style="text-align:right;" class="tem Family form-control number fldtableinput" data-fInd="'+s+'" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'"></td>';else if("Date/Time"==callParentNew("FDataType")[s])g+='<td class="input-group-sm"><input '+h+r+t+n+' type="text" class="tem Family form-control flatpickr-input fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'">',g+='<span class="input-group-addon spandate "><i class="glyphicon glyphicon-calendar icon-basic-calendar" title='+colNames[w]+"></i></span></td>";else if(""!=a&&"Accept"==callParentNew("FMoe")[s]&&""!=$(callParentNew(o)).val()&&$(callParentNew(o)).val().indexOf(",")>0){var p=$(callParentNew(o)).val().split(","),f=e;for(S="",S+='<option value="">-- Select --</option>',V=0;V<p.length;V++)""!=f&&f==p[V]?S+='<option selected="selected" value="'+p[V]+'">'+p[V]+"</option>":S+='<option value="'+p[V]+'">'+p[V]+"</option>";g+='<td class="input-group-sm"><select '+h+r+t+n+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+f+'">'+S+"</select></td>"}else g+='<td class="input-group-sm"><input '+h+r+t+n+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+I)+'" value="'+e+'"></td>';parent.ChangedTblFieldVals[w]=0==I?e:parent.ChangedTblFieldVals[w]+"~"+e};for(w=0;w<u;w++){D()}g+="</tr>"}e='<div class="">',e+='<div class="pb-5">',"t"!=v.toLowerCase()&&"true"!=v.toLowerCase()||(e+='<div class="btn btn-sm btn-icon btn-white btn-color-gray-600 btn-active-primary me-2 shadow-sm pull-left '+h+'"><span class="material-icons material-icons-style material-icons-3" title="Add" onclick="AddTableRows(\'fldTable\');">add</span></div>'),"t"!=f.toLowerCase()&&"true"!=f.toLowerCase()||(e+='<div class="btn btn-sm btn-icon btn-white btn-color-gray-600 btn-active-primary me-2 shadow-sm pull-left '+h+'"><span class="material-icons material-icons-style material-icons-3" title="Delete" onclick="DeleteTableRows(\'fldTable\');">delete_outline</span></div>'),""!=isQuery&&(e+='<div class="btn btn-sm btn-icon btn-white btn-color-gray-600 btn-active-primary me-2 shadow-sm pull-left '+h+'"><span class="material-icons material-icons-style material-icons-3" title="Fill Data" onclick="SqlFillData();">view_list</span></div>'),e+='<table id="fldTable" class="table table-bordered table-sm mt-10">',e+="<thead>",e+=b,e+="</thead>",e+="<tbody>",e+=g,e+="</tbody>",e+="</table>",e+="</div>",e+="<div></div>",e+='<div class="float-end d-none"><a href="javascript:void(0)" onclick="ClearTableData(\'fldTable\');" class="btn btn-white btn-color-gray-700 btn-active-primary d-inline-flex align-items-center shadow-sm me-2 '+h+'"><span class="material-icons">clear</span>Clear</a><a href="javascript:void(0);" title="Ok" onclick="AddTableData(\''+thisFldId+"','"+valuesep+"','"+rowsep+'\');" class="btn btn-primary d-inline-flex align-items-center shadow-sm me-2 '+h+'"><span class="material-icons">save</span>Ok</a></div>',e+="</div>",""==m&&"sqlDescr"==isQuery&&setTimeout(function(){SqlFillData()},0)}else{var j="";""!=a&&(j=(j=a).split(valuesep));var A='<div id="divtblForm" >',T=function(){var e=d.columns[w+1].caption;A+='<div class="col-lg-12 col-sm-3 col-md-3 col-xs-12"><label>'+e+"</label></div>",A+='<div class="col-lg-12 col-sm-9 col-md-9 col-xs-12">',colNames.push(d.columns[w+1].name),parent.ChangedTblFields.push(d.columns[w+1].name),parent.ChangedTblFieldVals.push("");var a=d.columns[w+1].exp;if(colfExp.push(a),F="",""!=a&&(a=a.replace(/,/g,"♦"),F=callParentNew("Evaluate("+d.columns[w+1].name+",000,"+a+",expr,table)","function")),fldExpData.push(F),colVExp.push(d.columns[w+1].vexp),"undefined"!=typeof d.columns[w+1].aportionwhat&&""!=d.columns[w+1].aportionwhat){aportionWhat.push(d.columns[w+1].aportionwhat);var t=d.columns[w+1].aportionwhat;x=$j($j("[id*='"+t+"']",doParentOpInIframe("document","rtn","[id*='"+t+"']")).find("input")).attr("id"),aportionWhatVal.push($(callParentNew(x,"id")).val())}else aportionWhat.push(""),aportionWhatVal.push("");"undefined"!=typeof d.columns[w+1].aportionagainst?aportionAgainst.push(d.columns[w+1].aportionagainst):aportionAgainst.push("");var n="";n="undefined"!=typeof j[w]&&""!=j[w]&&""!=j?j[w]:"undefined"!=typeof fldExpData[w]&&""!=fldExpData[w]?fldExpData[w]:"undefined"!=typeof aportionWhatVal[w]&&""!=aportionWhatVal[w]?aportionWhatVal[w]:d.columns[w+1].value;var r=d.columns[w+1].source,s="";"undefined"!=typeof d.columns[w+1].allowempty&&""!=d.columns[w+1].allowempty&&(s="f"==d.columns[w+1].allowempty.toLowerCase()?" data-ae='false' ":"");var i="";"undefined"!=typeof d.columns[w+1].allowduplicate&&""!=d.columns[w+1].allowduplicate&&(i="f"==d.columns[w+1].allowduplicate.toLowerCase()?" data-ad='false' ":"");var o="";"undefined"!=typeof d.columns[w+1].readyonly&&""!=d.columns[w+1].readyonly&&(o="t"==d.columns[w+1].readyonly.toLowerCase()?" disabled ":""),colSource.push(r);var c=callParentNew("GetFieldIndex("+r+")","function"),u=(callParentNew("GetDWBFieldType('',"+c+")","function"),callParentNew("GetDcNo("+r+")","function")),p=r+l+"F"+u;if("Select"==callParentNew("FMoe")[c])if("True"==callParentNew("FldIsSql")[c])A+='<td class="input-group-sm"><select '+h+o+s+i+' class="combotem Family form-control form-select tblFromSelect fldtableinput" data-control="select2" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'" data-id="'+p+'" data-placeholder="Select an option" data-allow-clear="true">',""!=n&&(A+='<option value="'+n+'" selected="selected">'+n+"</option>"),A+="</select></td>";else if(S="",$(callParentNew(p)).find("option").each(function(){""!=n&&$(this)[0].value==n?S+=$(this)[0].outerHTML.replace("<option ","<option selected "):S+=$(this)[0].outerHTML.replace('selected="selected"',"")}),""==S){var f=$(callParentNew(p)).data("val").split(","),v=""==$(callParentNew(p)).val()?n:$(callParentNew(p)).val();for(V=0;V<f.length;V++)""!=v&&v==f[V]?S+='<option selected="selected" value="'+f[V]+'">'+(""==f[V]?"-- Select --":f[V])+"</option>":S+='<option value="'+f[V]+'">'+(""==f[V]?"-- Select --":f[V])+"</option>";A+="<select "+h+o+s+i+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+v+'">'+S+"</select>"}else A+="<select "+h+o+s+i+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">'+S+"</select>";else if("Accept"==callParentNew("FMoe")[c]&&"True"==callParentNew("FldIsSql")[c])A+="<input "+h+o+s+i+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">';else if("undefined"!=typeof aportionWhat[w]&&""!=aportionWhat[w])A+="<input "+h+o+s+i+' type="text" class="tem Family form-control fldtableinput" readonly name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">';else if("Numeric"==callParentNew("FDataType")[c])A+="<input "+h+o+s+i+' type="text" style="text-align:right;" class="tem Family form-control number fldtableinput" data-fInd="'+c+'" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">';else if("Date/Time"==callParentNew("FDataType")[c])A+='<div class="input-group"><input '+h+o+s+i+' type="text" class="tem Family form-control flatpickr-input fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">',A+='<span class="input-group-addon spandate "><i class="glyphicon glyphicon-calendar icon-basic-calendar" title="'+colNames[w]+'"></i></span></div>';else if(""!=r&&"Accept"==callParentNew("FMoe")[c]&&""!=$(callParentNew(p)).val()&&$(callParentNew(p)).val().indexOf(",")>0){var m=$(callParentNew(p)).val().split(","),b=n;for(S="",S+='<option value="">-- Select --</option>',V=0;V<m.length;V++)""!=b&&b==m[V]?S+='<option selected="selected" value="'+m[V]+'">'+m[V]+"</option>":S+='<option value="'+m[V]+'">'+m[V]+"</option>";A+="<select "+h+o+s+i+' class="tem Family form-control" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+b+'">'+S+"</select>"}else A+="<input "+h+o+s+i+' type="text" class="tem Family form-control fldtableinput" name="'+colNames[w]+'" id="'+(colNames[w]+0)+'" value="'+n+'">';parent.ChangedTblFieldVals[w]=0==w?n:parent.ChangedTblFieldVals[w]+"~"+n,A+='</div><div class="clearfix"></div>'};for(w=0;w<u;w++){var S,V;T()}e="<div>",e+=A+="</div>",e+='</div><div class="clearfix"></div>',e+='<div class="d-none"><div class="col-12 float-end"><a href="javascript:void(0)" onclick="ClearTableData(\'fldTable\');" title="Clear" class="btn btn-white btn-color-gray-700 btn-active-primary d-inline-flex align-items-center shadow-sm me-2 '+h+'"><span class="material-icons">clear</span>Clear</a><a href="javascript:void(0);" title="Ok" onclick="AddTableData(\''+thisFldId+"','"+valuesep+"','"+rowsep+'\');" class="btn btn-primary d-inline-flex align-items-center shadow-sm me-2 '+h+'"><span class="material-icons">save</span>Ok</a></div></div>'}}}}catch(R){}$("#divTable").html(e);try{parent.AxAfterTableLoad()}catch(R){}}function AddTableData(){var e="",a=!0,t="";if($("#fldTable tbody tr").length>0)$("#fldTable tbody tr").each(function(){var l="";$(this).find("td").each(function(){if($(this).find("select").length>0&&void 0!==$(this).find("select").attr("value")){if(void 0!==$(this).find("select").data("ae")&&0==$(this).find("select").data("ae")&&""==$(this).find("select").attr("value"))return callParentNew('showAlertDialog("error",'+$(this).find("select").attr("id")+" cannot be left empty.)","function"),$(this).find("select").focus(),a=!1,!1;if(void 0!==$(this).find("select").data("ad")&&0==$(this).find("select").data("ad")&&""!=$(this).find("select").attr("value")){var e=$(this).find("select").attr("name")+"~"+$(this).find("select").attr("value")+"♠";if(t.indexOf(e)>-1)return callParentNew('showAlertDialog("error",'+$(this).find("select").attr("id")+" duplicate value not allowed.)","function"),$(this).find("select").focus(),a=!1,!1;t+=$(this).find("select").attr("name")+"~"+$(this).find("select").attr("value")+"♠"}l+=$(this).find("select").attr("value")+valuesep}else if($(this).find("input:text").length>0){if(void 0!==$(this).find("input").data("ae")&&0==$(this).find("input").data("ae")&&""==$(this).find("input").attr("value"))return callParentNew('showAlertDialog("error",'+$(this).find("input").attr("id")+" cannot be left empty.)","function"),$(this).find("input").focus(),a=!1,!1;if(void 0!==$(this).find("input").data("ad")&&0==$(this).find("input").data("ad")&&""!=$(this).find("input").attr("value")){var n=$(this).find("input").attr("name")+"~"+$(this).find("input").attr("value")+"♠";if(t.indexOf(n)>-1)return callParentNew('showAlertDialog("error",'+$(this).find("input").attr("id")+" duplicate value not allowed.)","function"),$(this).find("select").focus(),a=!1,!1;t+=$(this).find("input").attr("name")+"~"+$(this).find("input").attr("value")+"♠"}l+=$(this).find("input").attr("value")+valuesep}}),""!=l&&(l=l.substring(0,l.length-1)),e+=l+rowsep});else{var l="";$("#divTable").find("input,select").each(function(){if($(this).is("select")&&void 0!==$(this).attr("value")){if(void 0!==$(this).data("ae")&&0==$(this).data("ae")&&""==$(this).attr("value"))return callParentNew('showAlertDialog("error",'+$(this).attr("name")+" cannot be left empty.)","function"),$(this).find("select").select2("open"),a=!1,!1;l+=$(this).attr("value")+valuesep}else if($(this).is("input")&&"text"==$(this).attr("type")){if(void 0!==$(this).data("ae")&&0==$(this).data("ae")&&""==$(this).attr("value"))return callParentNew('showAlertDialog("error",'+$(this).attr("name")+" cannot be left empty.)","function"),$(this).find("input").focus(),a=!1,!1;l+=$(this).attr("value")+valuesep}}),""!=l&&(l=l.substring(0,l.length-1)),e+=l+rowsep}if(a){e=e.substring(0,e.length-1),$j("#"+thisFldId,doParentOpInIframe("document","rtn","#"+thisFldId)).val(e),UpdateArray(thisFldId,e),parent.CallbackFunctionBootstrap(thisFldId);try{parent.AxAfterAddTableData()}catch(n){}callParentNew("modalIdTableField","id").dispatchEvent(new CustomEvent("close"))}}function ClearTableData(e){$("#"+e+" tbody tr td").each(function(){$(this).find("input:text").val(""),$(this).find("input:text").attr("value",""),$(this).find("select").val(""),$(this).find("select").prop("selected",!1),$(this).find("select").hasClass("tblFromSelect")&&$(this).find("select").find("option").remove()})}function DeleteTableRows(e){$("#"+e+" tbody tr").each(function(){void 0!==$(this).find(".fgChk:checked").prop("checked")&&$(this).find(".fgChk:checked").prop("checked")&&$(this).remove()})}function AddTableRows(e){var a=$("#"+e+" tbody tr:last"),t=$("#"+e+" tbody tr:last").attr("id");$(a).clone().insertAfter(a).find("input:text").val(""),$("#"+e+" tbody tr:last").find("select,input,div.autoclear i,div.edit i,div[id^=autoadv],div[id^=autoadv] i").each(function(e,a){var l=$j(this);if(l.hasClass("tblFromSelect")){var n=l.attr("disabled"),r=l.parent("td"),s=l.attr("name"),i=s+(parseInt(t)+1),o=l.attr("data-id"),d=l.attr("class");d=d.replace(" select2-hidden-accessible"," "),l.siblings("span.select2").remove(),l.remove();var c=void 0!==l.data("ae")&&0==l.data("ae")?" data-ae='false' ":"",u=void 0!==l.data("ad")&&0==l.data("ad")?" data-ad='false' ":"";r.html("<select "+n+c+u+' class="'+d+'" data-control="select2" name='+s+" id="+i+' value="" data-id='+o+' data-placeholder="Select an option" data-allow-clear="true"></select>')}else{if(id=l.attr("data-clk"),id!=undefined)l.attr("data-clk",$j(this).parents(".autoinput-parent").find("input").attr("id"));else{var p=l.attr("name"),f=p+(parseInt(t)+1);l.attr("id",f)}}}),$("#"+e+" tbody tr:last").attr("id",(parseInt(t)+1).toString()),LoadTableEvents("#divTable")}function MainBlur(obj,type){var fldInd=colNames.indexOf(obj.attr("name"));if("undefined"!=typeof colVExp[fldInd]&&""!=colVExp[fldInd]){var vExp=colVExp[fldInd].replace(/,/g,"♦"),vRowNo=obj.attr("id").replace(obj.attr("name"),""),indx=$j.inArray(obj.attr("name"),parent.ChangedTblFields),cellVal=parent.ChangedTblFieldVals[indx].split("~");cellVal[vRowNo]=$(obj).val(),parent.ChangedTblFieldVals[indx]=cellVal.join("~");var fResult=callParentNew("Evaluate("+obj.attr("name")+","+vRowNo+","+vExp+",vexpr,table)","function");if("T"!=fResult&&"t"!=fResult&&1!=fResult){var cutMsg=eval(callParent("lcm[52]")),firstChar=fResult.substring(0,1),alertMsg=fResult.substring(1);if("_"!=firstChar){if("?"==firstChar){if(showAlertDialog("error",alertMsg),"input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var ddlValue=$j(obj).val();$(obj).hasClass("tblFromSelect")?($(obj).append('<option value="'+ddlValue+'" selected="selected">'+ddlValue+"</option>"),$(obj).attr("value",ddlValue)):($j(obj).attr("selected","selected"),$(obj).attr("value",ddlValue))}return!1}if("*"==firstChar)return showAlertDialog("error",alertMsg),!1;if("MessageSetAxFont"==fResult)return!0;if(confirm(fResult+". "+cutMsg)){if("input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var _ddlValue=$j(obj).val();$(obj).hasClass("tblFromSelect")?($(obj).append('<option value="'+_ddlValue+'" selected="selected">'+_ddlValue+"</option>"),$(obj).attr("value",_ddlValue)):($j(obj).attr("selected","selected"),$(obj).attr("value",_ddlValue))}return!1}return!0}showAlertDialog("error",alertMsg)}TableEvalonBlur(indx,vRowNo)}else{if("input"==type)$(obj).val($(obj).val()),$(obj).attr("value",$(obj).val());else{var _ddlValue2=$j(obj).val();$(obj).hasClass("tblFromSelect")?($(obj).append('<option value="'+_ddlValue2+'" selected="selected">'+_ddlValue2+"</option>"),$(obj).attr("value",_ddlValue2)):($j(obj).attr("selected","selected"),$(obj).attr("value",_ddlValue2))}var vRowNo=obj.attr("id").replace(obj.attr("name"),""),indx=$j.inArray(obj.attr("name"),parent.ChangedTblFields),cellVal=parent.ChangedTblFieldVals[indx].split("~");cellVal[vRowNo]=$(obj).val(),parent.ChangedTblFieldVals[indx]=cellVal.join("~"),TableEvalonBlur(indx,vRowNo)}Aportion(obj)}function TableEvalonBlur(e,a){if("undefined"!=typeof colfExp[e]&&""==colfExp[e])for(var t=e;t<colfExp.length;t++)if("undefined"!=typeof colfExp[t]&&""!=colfExp[t]){var l=colfExp[t].replace(/,/g,"♦"),n=$("#"+colNames[t]+a),r=$j.inArray(n.attr("name"),parent.ChangedTblFields),s=parent.ChangedTblFieldVals[r].split("~");s[a]=$(n).val(),parent.ChangedTblFieldVals[r]=s.join("~");var i=callParentNew("Evaluate("+n.attr("name")+","+a+","+l+",expr,table)","function");if(""!=i){if("text"==$(n).attr("type"))$(n).val(i),$(n).attr("value",i);else{var o=i;$j(n).attr("selected","selected"),$(n).attr("value",o)}s[a]=i,parent.ChangedTblFieldVals[r]=s.join("~")}}}function UpdateArray(e,a){for(var t=!1,l=0;l<doParentOpInIframe("ChangedFields","rtn").length;l++){if(doParentOpInIframe("ChangedFields["+l+"]","rtn").toString()==e){"***"==a?(doParentOpInIframe("ChangedFields","rtn").splice(l,1),doParentOpInIframe("ChangedFieldDbRowNo","rtn").splice(l,1),doParentOpInIframe("ChangedFieldValues","rtn").splice(l,1),doParentOpInIframe().ChangedFieldOldValues.splice(l,1)):(doParentOpInIframe("ChangedFieldOldValues["+l+"]","var",doParentOpInIframe("ChangedFieldValues["+l+"]","rtn").toString()),doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","var",doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","rtn")),doParentOpInIframe("ChangedFieldValues["+l+"]","var",a)),t=!0;break}}if(!t&&"***"!=a){var n=e.lastIndexOf("F"),r=e.substring(n-3,n),s=e.substring(n+1),i=callParentNew("GetDbRowNo("+r+","+s+")","function");parent.ChangedFields.push(e),parent.ChangedFieldDbRowNo.push(i),parent.ChangedFieldValues.push(a),parent.ChangedFieldOldValues.push("")}}function CheckSpecialCharsInStr(e){return e=(e=e)!=undefined?(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;"):""}function RepSpecialCharsInHTML(e){return e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function CheckAll(e){$j("input[name=chkItem]:checkbox").each(function(){$j(this).prop("checked",e.checked)})}function ChkHdrCheckbox(e,a){$j(".fgChk:visible").length==$j(".fgChk:checked").length?$j(".fgHdrChk").prop("checked",!0):$j(".fgHdrChk").prop("checked",!1)}function GetTblFldAutoData(thisId,thisfldId){fldAutoData=[];var custData=callParentNew("AxGetCustSelectFldData("+thisfldId+")","function");if(""!=custData){fldAutoList=thisfldId;var JsonData=JSON.parse(custData),fldData=JsonData.pickdata[3].data,aSearch=[];if($(fldData).each(function(e,a){a.i=a.i.replace(/\^\^dq/g,'"'),aSearch.push(a)}),0!=aSearch.length){var result=$.map(aSearch,function(e){return e.i=e.i.replace(/\^\^dq/g,'"'),{id:""==e.v?e.i:e.v,text:e.i}});fldAutoData=result}else{var cutMsg=eval(callParent("lcm[0]"));fldAutoData={results:"",noResults:cutMsg}}}}function Aportion(e){colNames.indexOf(e.attr("name"));var a=e.attr("name"),t=aportionAgainst.indexOf(a);if(t>-1){var l=colNames[t],n=0;$('[name="'+l+'"]').each(function(){n=parseInt(n)+parseInt(""==$(this).val()?0:$(this).val())});var r=$(e).val();if(""!=r){var s=$(e).parents("tr").find("[name='"+l+"']").val(),i=$(e).parents("tr").find("[name='"+l+"']").attr("id");if(parseInt(r)<=parseInt(s)){$($("#"+i)).val(r),$($("#"+i)).attr("value",r);var o=$(e).parents("tr").next("tr").find("[name='"+l+"']").val(),d=$(e).parents("tr").next("tr").find("[name='"+l+"']").attr("id"),c=0;if($('[name="'+l+'"]').each(function(){c=parseInt(c)+parseInt(""==$(this).val()?0:$(this).val())}),""==o&&parseInt(aportionWhatVal[t])>parseInt(r)){var u=0;u=aportionWhatVal[t]==n?aportionWhatVal[t]-parseInt(c):aportionWhatVal[t]-(n+parseInt(r)),$($("#"+d)).val(u),$($("#"+d)).attr("value",u)}else if(""!=o&&parseInt(aportionWhatVal[t])>parseInt(n));}else if(""!=s&&"0"!=s||parseInt(aportionWhatVal[t])==parseInt(n)){if(""!=s&&""==aportionWhatVal[t])$($("#"+i)).val(r),$($("#"+i)).attr("value",r);else if(parseInt(aportionWhatVal[t])!=parseInt(n)){var p=parseInt(aportionWhatVal[t])-parseInt(n),f=$(e).parents("tr").find("[name='"+l+"']").val();r>=(p+=parseInt(f))?($($("#"+i)).val(p),$($("#"+i)).attr("value",p)):($($("#"+i)).val(r),$($("#"+i)).attr("value",r))}}else $($("#"+i)).val(r),$($("#"+i)).attr("value",r)}}}function SqlFillData(){if("true"==isQuery){var e="";try{$.ajax({url:"tsttable.aspx/GetSqlFillData",type:"POST",cache:!1,async:!0,data:JSON.stringify({tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val()}),dataType:"json",contentType:"application/json",success:function(a){if(""!=a.d){e=JSON.parse(a.d);for(var t=0;t<e.length;t++){var l=e[t];for(var n in l)for(var r in l[n]){var s=r,i=$($("#"+s+t));0==i.length&&(AddTableRows("fldTable"),i=$($("#"+s+t)));var o=l[n][r];if("text"==$(i).attr("type"))$(i).val(o),$(i).attr("value",o);else{var d=o;i.hasClass("tblFromSelect")?($(i).append('<option value="'+d+'" selected="selected">'+d+"</option>"),$(i).attr("value",d)):($(i).attr("selected","selected"),$(i).attr("value",d))}}}}else e=""},error:function(a){e=""}})}catch(d){}}else if("sqlDescr"==isQuery&&""!=QueryData){e=JSON.parse(QueryData);for(var a=0;a<e.length;a++){var t=e[a];for(var l in t)for(var n in t[l]){var r=n,s=$($("#"+r+a));0==s.length&&(AddTableRows("fldTable"),s=$($("#"+r+a)));var i=t[l][n];if("text"==$(s).attr("type"))$(s).val(i),$(s).attr("value",i);else{var o=i;s.hasClass("tblFromSelect")?($(s).append('<option value="'+o+'" selected="selected">'+o+"</option>"),$(s).attr("value",o)):($(s).attr("selected","selected"),$(s).attr("value",o))}}}}}function GetstrTableJson(e){var a="";try{$.ajax({url:"tsttable.aspx/GetstrTableJson",type:"POST",cache:!1,async:!1,data:JSON.stringify({descrName:e,tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val()}),dataType:"json",contentType:"application/json",success:function(e){if(""!=e.d){var t=e.d;QueryData=t.split("♥")[1],""!=(t=t.split("♥")[0])&&(a=t)}else a=""},error:function(e){a=""}})}catch(t){}return a}function GetAutoCompData(e,a,t,l){var n="";if(arrRefreshDcs.length>0)for(var r=0;r<arrRefreshDcs.length;r++){var s=arrRefreshDcs[r].split(":");n=s[1].replace("dc","")+","+s[0].replace("dc","")}a=CheckSpecialCharsInStr(a);var i=callParentNew("GetFieldsDcNo("+e+")","function");AxActiveRowNo=parseInt(callParentNew("GetFieldsRowNo("+e+")","function"),10),AxActiveRowNo=callParentNew("GetDbRowNo("+AxActiveRowNo+","+i+")","function");var o=AxActiveRowNo,d="";""!=AxActivePRow&&""!=AxActivePDc&&(d=AxActivePDc+"♠"+AxActivePRow);return t.toString()+"~"+l.toString()+"~"+i+"~"+o+"~"+d+"~~"+n}function GetDBProcTableJson(e){var a="";try{var t=$("#hdnfieldId").val().substring(0,$("#hdnfieldId").val().lastIndexOf("F")-3),l=callParentNew("GetFieldsRowNo("+$("#hdnfieldId").val()+")","function"),n=callParentNew("GetDcNo("+t+")","function"),r=callParentNew("GetDbRowNo("+l+","+n+")","function");$.ajax({url:"tsttable.aspx/GetDBProcTableJson",type:"POST",cache:!1,async:!1,data:JSON.stringify({procName:e,tstDId:callParentNew("tstDataId"),fldName:$("#hdnfieldId").val(),ChangedFields:parent.ChangedFields,ChangedFieldDbRowNo:parent.ChangedFieldDbRowNo,ChangedFieldValues:parent.ChangedFieldValues,DeletedDCRows:parent.DeletedDCRows,tfldDc:n,tfldRowNo:r}),dataType:"json",contentType:"application/json",success:function(e){if(""!=e.d){var t=e.d;QueryData=t.split("♥")[1],""!=(t=t.split("♥")[0])&&(a=t)}else a=""},error:function(e){a=""}})}catch(s){}return a}function GetSourceParamValue(e){var a="",t=void 0===e.parents("tr").attr("id")?"0":e.parents("tr").attr("id"),l=e.attr("name");return $(colNames).each(function(e,n){if(""!=colSource[e]&&l!=n){var r=n+t;$("#"+r).is("select")&&void 0!==$("#"+r).attr("value")&&""!=$("#"+r).attr("value")?a+=""==a?colSource[e]+":"+$("#"+r).attr("value"):"♠"+colSource[e]+":"+$("#"+r).attr("value"):$("#"+r).is("input")&&"text"==$("#"+r).attr("type")&&""!=$("#"+r).attr("value")&&(a+=""==a?colSource[e]+":"+$("#"+r).attr("value"):"♠"+colSource[e]+":"+$("#"+r).attr("value"))}}),a}