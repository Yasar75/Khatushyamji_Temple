/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function DoClientFunction(){var exectrace=$j("#hdnExeTrace").val();exectrace+="DoClientFunction function process started",UpdateExceptionMessageInET(exectrace);var fn=$j("#fname"),filename=escape(fn.val());filename=filename.replace(/%2C/g,",");var upl=$j("#upsts"),succ=upl.val(),fldId="",act=$j("#hdnAttFld"),hdnFilePath=$j("#hdnFilePath");if("Uploaded Successfully"==succ){eval(callParent("isGrdEditDirty")+"= true");var id=act.val(),rowFrmNo=id.substring(id.lastIndexOf("F")-3),rowNo=rowFrmNo.substring(0,rowFrmNo.lastIndexOf("F")),frmNo=rowFrmNo.substring(rowFrmNo.lastIndexOf("F")+1),hlFld=$j("#"+id,doParentOpInIframe("document","rtn","#"+id)),fldsByClass=doParentOpInIframe("document.getElementsByClassName('grdAttach')","rtn",".grdAttach"),tmpFldid="",hasReferFiles=!1;if("000"!=rowNo)for(var i=0;i<fldsByClass.length;i++)tmpFldid=fldsByClass[i].getAttribute("id"),(tmpFldid=="dc"+frmNo+"_image"+rowFrmNo||tmpFldid=="axp_gridattach_"+frmNo+rowFrmNo||null!=tmpFldid&&tmpFldid.startsWith("axp_nga_")&&tmpFldid.endsWith(rowFrmNo)||tmpFldid=="EDIT~dc"+frmNo+"_image"+rowFrmNo)&&(fldId=tmpFldid);else fldId=id.replace("nonGrdAtt_","");var dcNo=fldId.substring(fldId.lastIndexOf("F")+1,fldId.length),fieldName=callParentNew("GetFieldsName("+id+")","function"),existingFiles=$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId))[0].value;existingFiles!=undefined&&""!=existingFiles&&(-1!=existingFiles.indexOf("@")&&(hasReferFiles=!0,existingFiles=GetReferedFiles(existingFiles)),filename=existingFiles+","+filename,$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId)).val(""),$j("#GridAttach"+rowFrmNo,doParentOpInIframe("document","rtn","#GridAttach"+rowFrmNo)).html(""));var fileLinks="",bMultipleFiles=!1,totalFiles=1;if(filename.indexOf(",")>-1){bMultipleFiles=!0,arrFileNames=filename.split(","),totalFiles=arrFileNames.length,hlFld.innerHTML="";for(var referfilename="",j=0;j<arrFileNames.length;j++){var finalFileName=unescape(arrFileNames[j]).replace(/\s/g,"♠").replace(/\(/g,"♦").replace(/\)/g,"♣"),unescapedChar=unescape(arrFileNames[j]);if(hasReferFiles&&window.localStorage.refFiles!=undefined)if(-1==JSON.parse(window.localStorage.refFiles).indexOf(arrFileNames[j])){var fileOpenLink=arrFileNames[j];fileOpenLink=fileOpenLink.replace(/'/g,"♠"),fileLinks+="000"==rowNo?'<div id="Link_'+rowFrmNo+"_"+finalFileName+'"><a onclick="DeleteFileFromRow(\''+fldId+"','"+rowNo+"','"+fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'axp_nga_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+fileOpenLink+"\")'>"+unescapedChar+"</a></div>":'<div id="Link_'+rowFrmNo+"_"+finalFileName+'"><a onclick="DeleteFileFromRow(\''+fldId+"','"+rowNo+"','"+fileOpenLink+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'grdAtt_hlnk_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+fileOpenLink+"\")'>"+unescapedChar+"</a></div>"}else{var _fileOpenLink=arrFileNames[j];_fileOpenLink=_fileOpenLink.replace(/'/g,"♠"),fileLinks+="000"==rowNo?'<div id="Link'+finalFileName+"\"></a><a id='axp_nga_"+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+JSON.parse(window.localStorage.referRecId)+"-"+_fileOpenLink+"\")'>"+unescapedChar+"</a></div>":'<div id="Link'+finalFileName+"\"></a><a id='grdAtt_hlnk_"+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+JSON.parse(window.localStorage.referRecId)+"-"+_fileOpenLink+"\")'>"+unescapedChar+"</a></div>",""==referfilename?referfilename=arrFileNames[j].toString():referfilename+=","+arrFileNames[j].toString()}else{var _fileOpenLink2=arrFileNames[j];_fileOpenLink2=_fileOpenLink2.replace(/'/g,"♠"),fileLinks+="000"==rowNo?'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\"  class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink2+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'axp_nga_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+_fileOpenLink2+"\")'>"+unescapedChar+"</a></div>":'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\"  class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink2+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'grdAtt_hlnk_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+_fileOpenLink2+"\")'>"+unescapedChar+"</a></div>"}}""!=referfilename&&(filename=filename.replace(referfilename,JSON.parse(window.localStorage.fldExp)))}else{filename=unescape(filename);var finalFileName=filename.replace(/\s/g,"♠").replace(/\(/g,"♦").replace(/\)/g,"♣"),_fileOpenLink3=filename.replace(/'/g,"♠");fileLinks+="000"==rowNo?'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\" class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink3+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'axp_nga_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+_fileOpenLink3+"\")'>"+unescape(filename)+"</a></div>":'<div id="Link_'+rowFrmNo+"_"+finalFileName+"\" class='atchfile'><a onclick=\"DeleteFileFromRow('"+fldId+"','"+rowNo+"','"+_fileOpenLink3+'\')"><i class="glyphicon glyphicon-remove close icon-arrows-remove attachmentcrossicon"></i></a><a href="javascript:void(0)" id=\'grdAtt_hlnk_'+rowFrmNo+"' class='grdAttach handCur' onclick='ShowGridAttLink(\""+hdnFilePath.val()+_fileOpenLink3+"\")'>"+unescape(filename)+"</a></div>"}filename=unescape(filename),$j("input#"+fldId,doParentOpInIframe("document","rtn","input#"+fldId)).attr("value",filename).text(filename).val(filename),UpdateArray(fldId,filename),$j("#axpattach_filename"+frmNo+rowFrmNo,doParentOpInIframe("document","rtn","#axpattach_filename"+frmNo+rowFrmNo)).length>0&&(filename=$j("#axpattach_filename"+frmNo+rowFrmNo,doParentOpInIframe("document","rtn","#axpattach_filename"+frmNo+rowFrmNo)).val(),$j("#axpattach_filename"+frmNo+rowFrmNo,doParentOpInIframe("document","rtn","#axpattach_filename"+frmNo+rowFrmNo)).val(filename),UpdateArray("axpattach_filename"+frmNo+rowFrmNo,filename)),""!=$j("#hdnType").val()&&-1==filename.lastIndexOf(".")&&(filename+=$j("#hdnType").val());var labelHtml="";if(labelHtml="000"==rowNo?'<span id="nonGrdAtt_'+fldId+'" class="fa fa-paperclip upload-icon nongridAttachIcon inlinediv" style="" onclick="ShowGridAttachPopUp(this);" title="nongrid attachment"></span>':'<span id="grdAtt_img_'+rowFrmNo+'" tabindex=\'0\' class="fa fa-paperclip upload-icon inlinediv" onclick="ShowGridAttachPopUp(this);" class="grdAttach handCur" />',callParentNew("isMobile")?labelHtml+="<div id='grdAtt_hlnk_"+rowFrmNo+"attach' class='attach-files attach-popover' onclick=\"showAttachmentPopover();\" style='width:312px;'>"+fileLinks+"</div>":labelHtml+="<div id='grdAtt_hlnk_"+rowFrmNo+"attach' class='attach-files attach-popover' onclick=\"showAttachmentPopover();\">"+fileLinks+"</div>","000"==rowNo?(fieldName=callParentNew("GetFieldsName("+fldId+")","function"),$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn","#dv"+fieldName)).html(labelHtml)):$j("#GridAttach"+rowFrmNo,doParentOpInIframe("document","rtn","#GridAttach"+rowFrmNo)).html(labelHtml),"000"==rowNo){if($(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divnonattach").find(".attach-files").children().addClass("inlinediv"),$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divnonattach").find(".attach-files").height()>22){var fileName=$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn","#dv"+fieldName)).attr("data-morefiles");void 0!==fileName&&""!=fileName?fileName+=","+$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divnonattach").find(".attach-files").children().last().attr("id"):fileName=$(callParentNew("attach-files","class")).parent("#dv"+fieldName+" .divnonattach").find(".attach-files").children().last().attr("id"),$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn","#dv"+fieldName)).attr("data-morefiles",fileName);var popList=fileName.split(",");$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn","#dv"+fieldName)).find(".attach-files").children().each(function(e,a){var t=$(a).attr("id");$j.inArray(t,popList)>-1&&$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn","#dv"+fieldName)).find(".attach-files").find("[id^="+t.split(".")[0]+"]").addClass("revrseInlinediv")}),$j("#dv"+fieldName+" .divnonattach",doParentOpInIframe("document","rtn",".divnonattach")).append("<a class='pull-"+("ar"===callParentNew("gllangType","gllangType")?"left":"right")+" attachment-count' href='javascript:void(0)' class='' '><span data-target='grdAtt_hlnk_"+rowFrmNo+"attach' class='attach-popover' data-container='.dvheightframe' data-placement='bottom'>"+fileName.split(",").length+"+</span></a>")}}else{$(callParentNew("attach-files","class")).parent("#GridAttach"+rowFrmNo).find(".attach-files").children().addClass("inlinediv");var ftsize=$(callParentNew("attach-files","class")).parent("#GridAttach"+rowFrmNo).find(".attach-files").css("font-size"),minHght=20;if(void 0!==ftsize)if(ftsize=parseInt(ftsize.slice(0,-2)),ftsize<=14)minHght=20;else if(15==ftsize||16==ftsize)minHght=ftsize+6;else if(ftsize>16){var flotval=Math.floor((ftsize-14)/2+.5);minHght=ftsize+5+flotval}if($(callParentNew("attach-files","class")).parent("#GridAttach"+rowFrmNo).find(".attach-files")[0].offsetHeight>minHght){var fileNames=$j("#GridAttach"+rowFrmNo,doParentOpInIframe("document","rtn","#GridAttach"+rowFrmNo)).attr("data-morefiles");void 0!==fileNames&&""!=fileNames?fileNames+=","+$(callParentNew("attach-files","class")).parent("#GridAttach"+rowFrmNo).find(".attach-files").children().last().attr("id"):fileNames=$(callParentNew("attach-files","class")).parent("#GridAttach"+rowFrmNo).find(".attach-files").children().last().attr("id"),$j("#GridAttach"+rowFrmNo,doParentOpInIframe("document","rtn","#GridAttach"+rowFrmNo)).attr("data-morefiles",fileNames),fileNames.split(",").forEach(function(e){$(callParentNew(e,"id")).addClass("revrseInlinediv")}),$j("#GridAttach"+rowFrmNo,doParentOpInIframe("document","rtn","#GridAttach"+rowFrmNo)).append("<a class='pull-"+("ar"===callParentNew("gllangType","gllangType")?"left":"right")+" attachment-count' href='javascript:void(0)' class='' '><span data-target='grdAtt_hlnk_"+rowFrmNo+"attach' class='attach-popover' data-container='.dvheightframe' data-placement='bottom'>"+fileNames.split(",").length+"+</span></a>")}else callParentNew("isMobile")||$(callParentNew("wrapperForEditFields"+dcNo,"id")).children("#sp"+dcNo+"R"+rowFrmNo).css("height","90px"),$(callParentNew("attach-files","class")).children().last().removeClass("hide"),$(callParentNew("grdAtt_hlnk_"+rowFrmNo+"attach","id"))}callParentNew("axGridAttSavedPath=",$j("#hdnAxGridAttSavedPath").val()),callParentNew("showAttachmentPopover();","function"),callParentNew("assignInlineGridEditEvent("+frmNo+")","function"),UpdateExceptionMessageInET("DoClientFunction function process completed."),setTimeout(function(){closeUploadDialog()},300)}else UpdateExceptionMessageInET("DoClientFunction function process completed with "+succ),closeUploadDialog()}function updateAttachmentLabelCount1(e){try{0==$("#grdAtt_hlnk_"+e+"attach div").length?($("[data-target='grdAtt_hlnk_"+e+"attach']").remove(),$("#grdAtt_hlnk_"+e+"attach+.attachment-count").remove()):$("[data-target='grdAtt_hlnk_"+e+"attach']").text("")}catch(a){console.log("Exception: "+a)}}function GetReferedFiles(e){var a="",t=e,l=t.indexOf("("),i=t.indexOf(","),n=l+1,r=t.indexOf(")")-1;referRecId=t.substring(i+1,n-1);var o=t.substr(n,r-n+1);return""!=(a=t.substring(r+3))?o+","+a:o}function UpdateArray(e,a){for(var t=!1,l=0;l<doParentOpInIframe("ChangedFields","rtn").length;l++){if(doParentOpInIframe("ChangedFields["+l+"]","rtn").toString()==e){"***"==a?(doParentOpInIframe("ChangedFields","rtn").splice(l,1),doParentOpInIframe("ChangedFieldDbRowNo","rtn").splice(l,1),doParentOpInIframe("ChangedFieldValues","rtn").splice(l,1),doParentOpInIframe().ChangedFieldOldValues.splice(l,1)):(doParentOpInIframe("ChangedFieldOldValues["+l+"]","var",doParentOpInIframe("ChangedFieldValues["+l+"]","rtn").toString()),doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","var",doParentOpInIframe("ChangedFieldDbRowNo["+l+"]","rtn")),doParentOpInIframe("ChangedFieldValues["+l+"]","var",a)),t=!0;break}}if(!t&&"***"!=a){var i=e.lastIndexOf("F"),n=e.substring(i-3,i),r=e.substring(i+1),o=callParentNew("GetDbRowNo("+n+","+r+")","function");parent.ChangedFields.push(e),parent.ChangedFieldDbRowNo.push(o),parent.ChangedFieldValues.push(a),parent.ChangedFieldOldValues.push("")}}function ChangeTheme(){if(theme=eval(callParent("currentThemeColor")),""!=theme)$j("#themecss").attr("href","../App_Themes/"+theme+"/Stylesheet.min.css?v=23");else{var themeref="";parent&&(themeref=$j("#themecss",parent.document).attr("href"),""!=themeref&&$j("#themecss").attr("href",themeref)),parent.parent.document&&(themeref=$j("#themecss",parent.parent.document).attr("href"),""!=themeref&&$j("#themecss").attr("href",themeref)),""!=themeref&&themeref!=undefined||(themeref="../App_Themes/"+axTheme+"/Stylesheet.min.css?v=23",$j("#themecss").attr("href",themeref))}}function closeUploadDialog(){$(parent.$(".custom-dialog"))!=undefined&&$(parent.$(".custom-dialog")).length>0&&($(parent).focus(),$(parent.$(".custom-dialog .close"))!=undefined&&$(parent.$(".custom-dialog .close")).length>0&&$(parent.$(".custom-dialog  .close"))[$(parent.$(".custom-dialog .close")).length-1].click(),setTimeout(function(){$(parent.$(".custom-dialog"))[$(parent.$(".custom-dialog")).length-1].remove()},300))}function AllowAttachements(){var e=$j("#hdnAttFld").val();e.startsWith("nonGrdAtt_")&&(e=e.replace("nonGrdAtt_",""));var a=$("#hdnDcNo").val(),t="";if(t=callParentNew("IsDcGrid("+a+")","function")?callParentNew("axInlineGridEdit")||"form"==callParentNew("AxpGridForm")?window.parent.$("#divDc"+a+" [id^=grdAtt_hlnk_]").find(".grdAttach").map(function(e,a){return a.text}).get().join(","):window.parent.$("#"+e).siblings(".attach-files").find(".grdAttach").map(function(e,a){return a.text}).get().join(","):window.parent.$("#"+e).siblings(".divnonattach").find("[id^=grdAtt_hlnk_]").find(".grdAttach").map(function(e,a){return a.text}).get().join(","),callParentNew("IsDcGrid("+a+")","function")){var l=window.parent.$("#"+e).attr("id"),i=l.substring(l.lastIndexOf("F"),l.lastIndexOf("F")-3);hdnImagePath.value=0!=window.parent.$("#dc"+a+"_imagepath"+i+"F"+a).length?window.parent.$("#dc"+a+"_imagepath"+i+"F"+a).val():""}if(null!=t&&""!=t){var n=$("#filMyFile").val();if(null!=n&&""!=n){n=n.substr(12);var r=!1;return $.each(t.split(","),function(e,a){if(a==n)return r=!0,!1}),!r||($("#fileuploadsts").text("File Already Exists"),$("#fileuploadsts").css("color","RED"),!1)}return!1}return!0}$j(document).ready(function(){modalHeader=eval(callParent("divModalHeader","id")+".getElementById('divModalHeader')"),modalHeader.innerText=eval(callParent("lcm[359]")),$("#cmdSend").prop("title",eval(callParent("lcm[360]"))).val(eval(callParent("lcm[360]"))),$("#close").prop("title",eval(callParent("lcm[249]"))).val(eval(callParent("lcm[249]"))),$("#filMyFile").bind({change:function change(){var existingFlCount=parent.$("#"+$j("#hdnAttFld").val()+"attach").parent().find(".attachment-count span").text();existingFlCount=""==existingFlCount?0:existingFlCount;var FileUploadlmt=eval(callParent("AxpFileUploadlmt")),uploadFileCount=$("#filMyFile")[0].files.length,totFlCount=parseInt(existingFlCount)+uploadFileCount;if(FileUploadlmt!=undefined&&0!=FileUploadlmt&&(uploadFileCount>FileUploadlmt||totFlCount>FileUploadlmt))return $("#filMyFile").val(""),$("#fileuploadsts").val(""),void $("#fileuploadsts").text("[Files can upload "+FileUploadlmt+" only.]");var filename=$("#filMyFile").val();if(filename.indexOf("+")>-1&&$("#fileuploadsts").text("[FileName should not contain '+' character.]"),/^\s*$/.test(filename)){$(".file-upload").removeClass("active");var cutMsg=eval(callParent("lcm[66]"));$("#noFile").text(cutMsg)}else $(".file-upload").addClass("active"),$("#noFile").text(filename.replace("C:\\fakepath\\",""));var uploadControl=$("#filMyFile")[0].files;uploadControl.length>0&&$("#lblnofilename").text(uploadControl[0].name),1==ValidateFileExtension(filename,"file")?($("#fileuploadsts").val(),$("#cmdSend").prop("disabled",!1),$(".file-upload").addClass("active"),$("#noFile").text(filename.replace("C:\\fakepath\\",""))):($("#fileuploadsts").text("["+eval(callParent("lcm[305]"))+"]"),$("#cmdSend").prop("disabled",!0),ResetFileUploadProperties())}}),checkSuccessAxpertMsg(),setTimeout(function(){IFrameModalDialogTabEvents("file-select")},500),closeRemodalPopupOnEsc(),validateFilesize()}),$(document).keydown(function(e){27==e.which&&$(parent.$(".modal"))!=undefined&&$(parent.$(".modal")).length>0&&($(parent).focus(),$(parent.$(".modal .close"))!=undefined&&$(parent.$(".modal .close")).length>0&&$(parent.$(".modal .close"))[$(parent.$(".modal .close")).length-1].click(),setTimeout(function(){$(parent.$(".modal"))[$(parent.$(".modal")).length-1].remove()},300))});