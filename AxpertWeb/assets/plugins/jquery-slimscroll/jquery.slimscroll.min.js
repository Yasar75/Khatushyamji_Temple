/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.1.1
 *
 */
(function(b){jQuery.fn.extend({slimScroll:function(a){var f={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200};var e=b.extend(f,a);this.each(function(){var D,I,R,M,c,H,N,S,Q="<div></div>",G=30,K=false;var L=b(this);if(L.parent().hasClass(e.wrapperClass)){var U=L.scrollTop();F=L.parent().find("."+e.barClass);X=L.parent().find("."+e.railClass);J();if(b.isPlainObject(a)){if("height" in a&&a.height=="auto"){L.parent().css("height","auto");L.css("height","auto");var O=L.parent().parent().innerHeight();L.parent().css("height",O);L.css("height",O)}if("scrollTo" in a){U=parseInt(e.scrollTo)}else{if("scrollBy" in a){U+=parseInt(e.scrollBy)}else{if("destroy" in a){F.remove();X.remove();L.unwrap();return}}}E(U,false,true)}return}e.height=(e.height=="auto")?L.parent().innerHeight():e.height;var T=b(Q).addClass(e.wrapperClass).css({position:"relative",overflow:"hidden",width:e.width,height:e.height});L.css({overflow:"hidden",width:e.width,height:e.height});var X=b(Q).addClass(e.railClass).css({width:e.size,height:"100%",position:"absolute",top:0,display:(e.alwaysVisible&&e.railVisible)?"block":"none","border-radius":e.size,background:e.railColor,opacity:e.railOpacity,zIndex:90});var F=b(Q).addClass(e.barClass).css({background:e.color,width:e.size,position:"absolute",top:0,opacity:e.opacity,display:e.alwaysVisible?"block":"none","border-radius":e.size,BorderRadius:e.size,MozBorderRadius:e.size,WebkitBorderRadius:e.size,zIndex:99});var W=(e.position=="right")?{right:e.distance}:{left:e.distance};X.css(W);F.css(W);L.wrap(T);L.parent().append(F);L.parent().append(X);if(e.railDraggable){F.draggable({axis:"y",containment:"parent",start:function(){R=true},stop:function(){R=false;P()},drag:function(g){E(0,b(this).position().top,false)}})}X.hover(function(){V()},function(){P()});F.hover(function(){I=true},function(){I=false});L.hover(function(){D=true;V();P()},function(){D=false;P()});L.bind("touchstart",function(g,h){if(g.originalEvent.touches.length){c=g.originalEvent.touches[0].pageY}});L.bind("touchmove",function(g){g.originalEvent.preventDefault();if(g.originalEvent.touches.length){var h=(c-g.originalEvent.touches[0].pageY)/e.touchScrollStep;c=g.originalEvent.touches[0].pageY;E(h,true)}});if(e.start==="bottom"){F.css({top:L.outerHeight()-F.outerHeight()});E(0,true)}else{if(e.start!=="top"){E(b(e.start).position().top,null,true);if(!e.alwaysVisible){F.hide()}}}C();J();function d(h){if(!D){return}var h=h||window.event;var g=0;if(h.wheelDelta){g=-h.wheelDelta/120}if(h.detail){g=h.detail/3}var i=h.target||h.srcTarget||h.srcElement;if(b(i).closest("."+e.wrapperClass).is(L.parent())){E(g,true)}if(h.preventDefault&&!K){h.preventDefault()}if(!K){h.returnValue=false}}function E(g,j,l){var h=g;var i=L.outerHeight()-F.outerHeight();if(j){h=parseInt(F.css("top"))+g*parseInt(e.wheelStep)/100*F.outerHeight();h=Math.min(Math.max(h,0),i);h=(g>0)?Math.ceil(h):Math.floor(h);F.css({top:h+"px"})}N=parseInt(F.css("top"))/(L.outerHeight()-F.outerHeight());h=N*(L[0].scrollHeight-L.outerHeight());if(l){h=g;var k=h/L[0].scrollHeight*L.outerHeight();k=Math.min(Math.max(k,0),i);F.css({top:k+"px"})}L.scrollTop(h);L.trigger("slimscrolling",~~h);V();P()}function C(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",d,false);this.addEventListener("mousewheel",d,false)}else{document.attachEvent("onmousewheel",d)}}function J(){H=Math.max((L.outerHeight()/L[0].scrollHeight)*L.outerHeight(),G);F.css({height:H+"px"});var g=H==L.outerHeight()?"none":"block";F.css({display:g})}function V(){J();clearTimeout(M);if(N==~~N){K=e.allowPageScroll;if(S!=N){var g=(~~N==0)?"top":"bottom";L.trigger("slimscroll",g)}}S=N;if(H>=L.outerHeight()){K=true;return}F.stop(true,true).fadeIn("fast");if(e.railVisible){X.stop(true,true).fadeIn("fast")}}function P(){if(!e.alwaysVisible){M=setTimeout(function(){if(!(e.disableFadeOut&&D)&&!I&&!R){F.fadeOut("slow");X.fadeOut("slow")}},1000)}}});return this}});jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);