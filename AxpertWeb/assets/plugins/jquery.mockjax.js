/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.5.0pre
 * Released:
 * Home:   http://github.com/appendto/jquery-mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 *
 * Copyright (c) 2011 appendTo LLC.
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 */
(function(e){var c=e.ajax,d=[],l=/=\?(&|$)/,o=(new Date()).getTime();function k(t){if(window.DOMParser==undefined&&window.ActiveXObject){DOMParser=function(){};DOMParser.prototype.parseFromString=function(z){var y=new ActiveXObject("Microsoft.XMLDOM");y.async="false";y.loadXML(z);return y}}try{var v=(new DOMParser()).parseFromString(t,"text/xml");if(e.isXMLDoc(v)){var u=e("parsererror",v);if(u.length==1){throw ("Error: "+e(v).text())}}else{throw ("Unable to parse XML")}}catch(w){var x=(w.name==undefined?w:w.name+": "+w.message);e(document).trigger("xmlParseError",[x]);return undefined}return v}function n(v,u,t){(v.context?jQuery(v.context):jQuery.event).trigger(u,t)}function f(t,u){var v=false;if(typeof u==="string"){return e.isFunction(t.test)?t.test(u):t==u}e.each(t,function(x,w){if(u[x]===undefined){v=false;return v}else{v=true;if(typeof u[x]=="object"){return f(t[x],u[x])}else{if(e.isFunction(t[x].test)){v=t[x].test(u[x])}else{v=(t[x]==u[x])}return v}}});return v}function r(t,v){if(e.isFunction(t)){return t(v)}if(e.isFunction(t.url.test)){if(!t.url.test(v.url)){return null}}else{var u=t.url.indexOf("*");if(t.url!==v.url&&u===-1||!new RegExp(t.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".+")).test(v.url)){return null}}if(t.data&&v.data){if(!f(t.data,v.data)){return null}}if(t&&t.type&&t.type.toLowerCase()!=v.type.toLowerCase()){return null}return t}function s(t,u){var v=e.extend({},e.mockjaxSettings,t);if(v.log&&e.isFunction(v.log)){v.log("MOCK "+u.type.toUpperCase()+": "+u.url,e.extend({},u))}}function g(u,w,t){var v=(function(x){return function(){return(function(){this.status=u.status;this.statusText=u.statusText;this.readyState=4;if(e.isFunction(u.response)){u.response(t)}if(w.dataType=="json"&&(typeof u.responseText=="object")){this.responseText=JSON.stringify(u.responseText)}else{if(w.dataType=="xml"){if(typeof u.responseXML=="string"){this.responseXML=k(u.responseXML)}else{this.responseXML=u.responseXML}}else{this.responseText=u.responseText}}if(typeof u.status=="number"||typeof u.status=="string"){this.status=u.status}if(typeof u.statusText==="string"){this.statusText=u.statusText}if(e.isFunction(this.onreadystatechange)){if(u.isTimeout){this.status=-1}this.onreadystatechange(u.isTimeout?"timeout":undefined)}else{if(u.isTimeout){this.status=-1}}}).apply(x)}})(this);if(u.proxy){c({global:false,url:u.proxy,type:u.proxyType,data:u.data,dataType:w.dataType==="script"?"text/plain":w.dataType,complete:function(y,x){u.responseXML=y.responseXML;u.responseText=y.responseText;u.status=y.status;u.statusText=y.statusText;this.responseTimer=setTimeout(v,u.responseTime||0)}})}else{if(w.async===false){v()}else{this.responseTimer=setTimeout(v,u.responseTime||50)}}}function h(v,w,t,u){v=e.extend({},e.mockjaxSettings,v);if(typeof v.headers==="undefined"){v.headers={}}if(v.contentType){v.headers["content-type"]=v.contentType}return{status:v.status,statusText:v.statusText,readyState:1,open:function(){},send:function(){u.fired=true;g.call(this,v,w,t)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(y,x){v.headers[y]=x},getResponseHeader:function(x){if(v.headers&&v.headers[x]){return v.headers[x]}else{if(x.toLowerCase()=="last-modified"){return v.lastModified||(new Date()).toString()}else{if(x.toLowerCase()=="etag"){return v.etag||""}else{if(x.toLowerCase()=="content-type"){return v.contentType||"text/plain"}}}}},getAllResponseHeaders:function(){var x="";e.each(v.headers,function(z,y){x+=z+": "+y+"\n"});return x}}}function j(z,x,t){b(z);z.dataType="json";if(z.data&&l.test(z.data)||l.test(z.url)){p(z,x);var v=/^(\w+:)?\/\/([^\/?#]+)/,y=v.exec(z.url),w=y&&(y[1]&&y[1]!==location.protocol||y[2]!==location.host);z.dataType="script";if(z.type.toUpperCase()==="GET"&&w){var u=m(z,x,t);if(u){return u}else{return true}}}return null}function b(t){if(t.type.toUpperCase()==="GET"){if(!l.test(t.url)){t.url+=(/\?/.test(t.url)?"&":"?")+(t.jsonp||"callback")+"=?"}}else{if(!t.data||!l.test(t.data)){t.data=(t.data?t.data+"&":"")+(t.jsonp||"callback")+"=?"}}}function m(w,v,t){var u=t&&t.context||w,x=null;if(v.response&&e.isFunction(v.response)){v.response(t)}else{if(typeof v.responseText==="object"){e.globalEval("("+JSON.stringify(v.responseText)+")")}else{e.globalEval("("+v.responseText+")")}}i(w,v);q(w,v);if(jQuery.Deferred){x=new jQuery.Deferred();if(typeof v.responseText=="object"){x.resolve(v.responseText)}else{x.resolve(jQuery.parseJSON(v.responseText))}}return x}function p(u,t){jsonp=u.jsonpCallback||("jsonp"+o++);if(u.data){u.data=(u.data+"").replace(l,"="+jsonp+"$1")}u.url=u.url.replace(l,"="+jsonp+"$1");window[jsonp]=window[jsonp]||function(v){data=v;i(u,t);q(u,t);window[jsonp]=undefined;try{delete window[jsonp]}catch(w){}if(head){head.removeChild(script)}}}function i(u,t){if(u.success){u.success.call(callbackContext,(t.response?t.response.toString():t.responseText||""),status,{})}if(u.global){n(u,"ajaxSuccess",[{},u])}}function q(u,t){if(u.complete){u.complete.call(callbackContext,{},status)}if(u.global){n("ajaxComplete",[{},u])}if(u.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}}function a(v,t){var y,x,w;if(typeof v==="object"){t=v;v=undefined}else{t.url=v}x=jQuery.extend(true,{},jQuery.ajaxSettings,t);for(var u=0;u<d.length;u++){if(!d[u]){continue}w=r(d[u],x);if(!w){continue}s(w,x);if(x.dataType==="jsonp"){if((y=j(x,w,t))){return y}}w.cache=x.cache;w.timeout=x.timeout;w.global=x.global;(function(B,C,z,A){y=c.call(e,e.extend(true,{},z,{xhr:function(){return h(B,C,z,A)}}))})(w,x,t,d[u]);return y}return c.apply(e,[t])}e.extend({ajax:a});e.mockjaxSettings={log:function(t){window.console&&window.console.log&&window.console.log(t)},status:200,statusText:"OK",responseTime:500,isTimeout:false,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}};e.mockjax=function(u){var t=d.length;d[t]=u;return t};e.mockjaxClear=function(t){if(arguments.length==1){d[t]=null}else{d=[]}};e.mockjax.handler=function(t){if(arguments.length==1){return d[t]}}})(jQuery);